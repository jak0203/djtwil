var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,g,k){if(k.get||k.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[g]=k.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var g=0;return $jscomp.iteratorPrototype(function(){return g<c.length?{done:!1,value:c[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.inherits=function(c,g){function k(){}k.prototype=g.prototype;c.prototype=new k;c.prototype.constructor=c;for(var a in g)if(Object.defineProperties){var l=Object.getOwnPropertyDescriptor(g,a);l&&Object.defineProperty(c,a,l)}else c[a]=g[a]};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var g=c[Symbol.iterator];return g?g.call(c):$jscomp.arrayIterator(c)};
$jscomp.arrayFromIterator=function(c){for(var g,k=[];!(g=c.next()).done;)k.push(g.value);return k};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};$jscomp.owns=function(c,g){return Object.prototype.hasOwnProperty.call(c,g)};
$jscomp.polyfill=function(c,g,k,a){if(g){k=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var l=c[a];l in k||(k[l]={});k=k[l]}c=c[c.length-1];a=k[c];g=g(a);g!=a&&null!=g&&$jscomp.defineProperty(k,c,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Object.assign",function(c){return c?c:function(c,k){for(var a=1;a<arguments.length;a++){var l=arguments[a];if(l)for(var h in l)$jscomp.owns(l,h)&&(c[h]=l[h])}return c}},"es6-impl","es3");
$jscomp.polyfill("WeakMap",function(c){function g(f){$jscomp.owns(f,a)||$jscomp.defineProperty(f,a,{value:{}})}function k(a){var b=Object[a];b&&(Object[a]=function(a){g(a);return b(a)})}if(function(){if(!c||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),e=new c([[a,2],[b,3]]);if(2!=e.get(a)||3!=e.get(b))return!1;e.delete(a);e.set(b,4);return!e.has(a)&&4==e.get(b)}catch(u){return!1}}())return c;var a="$jscomp_hidden_"+Math.random().toString().substring(2);k("freeze");k("preventExtensions");
k("seal");var l=0,h=function(a){this.id_=(l+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};h.prototype.set=function(f,b){g(f);if(!$jscomp.owns(f,a))throw Error("WeakMap key fail: "+f);f[a][this.id_]=b;return this};h.prototype.get=function(f){return $jscomp.owns(f,a)?f[a][this.id_]:void 0};h.prototype.has=function(f){return $jscomp.owns(f,a)&&$jscomp.owns(f[a],this.id_)};h.prototype.delete=
function(f){return $jscomp.owns(f,a)&&$jscomp.owns(f[a],this.id_)?delete f[a][this.id_]:!1};return h},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(c){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),e=new c($jscomp.makeIterator([[a,"s"]]));if("s"!=e.get(a)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var f=e.entries(),p=f.next();if(p.done||p.value[0]!=a||"s"!=p.value[1])return!1;p=f.next();return p.done||4!=p.value[0].x||"t"!=p.value[1]||!f.next().done?!1:!0}catch(q){return!1}}())return c;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var g=new WeakMap,k=function(a){this.data_={};this.head_=h();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};k.prototype.set=function(b,e){var f=a(this,b);f.list||(f.list=this.data_[f.id]=[]);f.entry?f.entry.value=e:(f.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,value:e},f.list.push(f.entry),this.head_.previous.next=f.entry,this.head_.previous=f.entry,this.size++);return this};k.prototype.delete=
function(b){b=a(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};k.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=h();this.size=0};k.prototype.has=function(b){return!!a(this,b).entry};k.prototype.get=function(b){return(b=a(this,b).entry)&&b.value};k.prototype.entries=function(){return l(this,function(a){return[a.key,
a.value]})};k.prototype.keys=function(){return l(this,function(a){return a.key})};k.prototype.values=function(){return l(this,function(a){return a.value})};k.prototype.forEach=function(a,e){for(var b=this.entries(),f;!(f=b.next()).done;)f=f.value,a.call(e,f[1],f[0],this)};k.prototype[Symbol.iterator]=k.prototype.entries;var a=function(a,e){var b;b=e&&typeof e;"object"==b||"function"==b?g.has(e)?b=g.get(e):(b=""+ ++f,g.set(e,b)):b="p_"+e;var h=a.data_[b];if(h&&$jscomp.owns(a.data_,b))for(a=0;a<h.length;a++){var q=
h[a];if(e!==e&&q.key!==q.key||e===q.key)return{id:b,list:h,index:a,entry:q}}return{id:b,list:h,index:-1,entry:void 0}},l=function(a,e){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:e(b)};b=null}return{done:!0,value:void 0}})},h=function(){var a={};return a.previous=a.next=a.head=a},f=0;return k},"es6-impl","es3");$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function g(){this.batch_=null}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;g.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};g.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var k=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(a){k(a,0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var f=0;f<a.length;++f){var b=a[f];delete a[f];try{b()}catch(e){this.asyncThrow_(e)}}}this.batch_=null};g.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var a=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var f=this.createResolveAndReject_();try{a(f.resolve,f.reject)}catch(b){f.reject(b)}};a.prototype.createResolveAndReject_=function(){function a(a){return function(e){b||(b=!0,a.call(f,e))}}var f=this,b=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};a.prototype.resolveTo_=function(h){if(h===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof a)this.settleSameAsPromise_(h);else{var f;a:switch(typeof h){case "object":f=null!=h;break a;case "function":f=!0;break a;default:f=!1}f?this.resolveToNonPromiseObj_(h):this.fulfill_(h)}};a.prototype.resolveToNonPromiseObj_=function(a){var f=void 0;try{f=a.then}catch(b){this.reject_(b);return}"function"==
typeof f?this.settleSameAsThenable_(f,a):this.fulfill_(a)};a.prototype.reject_=function(a){this.settle_(2,a)};a.prototype.fulfill_=function(a){this.settle_(1,a)};a.prototype.settle_=function(a,f){if(0!=this.state_)throw Error("Cannot settle("+a+", "+f|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=f;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,f=0;f<a.length;++f)a[f].call(),
a[f]=null;this.onSettledCallbacks_=null}};var l=new g;a.prototype.settleSameAsPromise_=function(a){var f=this.createResolveAndReject_();a.callWhenSettled_(f.resolve,f.reject)};a.prototype.settleSameAsThenable_=function(a,f){var b=this.createResolveAndReject_();try{a.call(f,b.resolve,b.reject)}catch(e){b.reject(e)}};a.prototype.then=function(c,f){function b(a,b){return"function"==typeof a?function(d){try{e(a(d))}catch(m){h(m)}}:b}var e,h,p=new a(function(a,b){e=a;h=b});this.callWhenSettled_(b(c,e),
b(f,h));return p};a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.callWhenSettled_=function(a,f){function b(){switch(e.state_){case 1:a(e.result_);break;case 2:f(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?l.asyncExecute(b):this.onSettledCallbacks_.push(function(){l.asyncExecute(b)})};a.resolve=function(c){return c instanceof a?c:new a(function(a,b){a(c)})};a.reject=function(c){return new a(function(a,b){b(c)})};
a.race=function(c){return new a(function(f,b){for(var e=$jscomp.makeIterator(c),h=e.next();!h.done;h=e.next())a.resolve(h.value).callWhenSettled_(f,b)})};a.all=function(c){var f=$jscomp.makeIterator(c),b=f.next();return b.done?a.resolve([]):new a(function(e,c){function p(a){return function(d){q[a]=d;h--;0==h&&e(q)}}var q=[],h=0;do q.push(void 0),h++,a.resolve(b.value).callWhenSettled_(p(q.length-1),c),b=f.next();while(!b.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(a.$jscomp$new$AsyncExecutor=function(){return new g});
return a},"es6-impl","es3");$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(c,g){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var k=0,a={next:function(){if(k<c.length){var l=k++;return{value:g(l,c[l]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};
$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");$jscomp.polyfill("Array.from",function(c){return c?c:function(c,k,a){$jscomp.initSymbolIterator();k=null!=k?k:function(a){return a};var l=[],h=c[Symbol.iterator];if("function"==typeof h)for(c=h.call(c);!(h=c.next()).done;)l.push(k.call(a,h.value));else for(var h=c.length,f=0;f<h;f++)l.push(k.call(a,c[f]));return l}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,k){return k})}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,k){return[c,k]})}},"es6-impl","es3");
$jscomp.checkStringArgs=function(c,g,k){if(null==c)throw new TypeError("The 'this' value for String.prototype."+k+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+k+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(c){var k=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var a="";c;)if(c&1&&(a+=k),c>>>=1)k+=k;return a}},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(c){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var k=Object.seal({x:4}),a=new c($jscomp.makeIterator([k]));if(!a.has(k)||1!=a.size||a.add(k)!=a||1!=a.size||a.add({x:4})!=a||2!=a.size)return!1;var l=a.entries(),h=l.next();if(h.done||h.value[0]!=k||h.value[1]!=k)return!1;h=l.next();return h.done||h.value[0]==k||4!=h.value[0].x||h.value[1]!=h.value[0]?!1:l.next().done}catch(f){return!1}}())return c;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var g=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)this.add(a.value)}this.size=this.map_.size};g.prototype.add=function(c){this.map_.set(c,c);this.size=this.map_.size;return this};g.prototype.delete=function(c){c=this.map_.delete(c);this.size=this.map_.size;return c};g.prototype.clear=function(){this.map_.clear();this.size=0};g.prototype.has=function(c){return this.map_.has(c)};g.prototype.entries=function(){return this.map_.entries()};
g.prototype.values=function(){return this.map_.values()};g.prototype.keys=g.prototype.values;g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(c,a){var l=this;this.map_.forEach(function(h){return c.call(a,h,h,l)})};return g},"es6-impl","es3");$jscomp.findInternal=function(c,g,k){c instanceof String&&(c=String(c));for(var a=c.length,l=0;l<a;l++){var h=c[l];if(g.call(k,h,l,c))return{i:l,v:h}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,k){return $jscomp.findInternal(this,c,k).v}},"es6-impl","es3");
(function e$jscomp$0(g,k,a){function l(b,e){if(!k[b]){if(!g[b]){var f="function"==typeof require&&require;if(!e&&f)return f(b,!0);if(h)return h(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",e;}e=k[b]={exports:{}};g[b][0].call(e.exports,function(a){var e=g[b][1][a];return l(e?e:a)},e,e.exports,e$jscomp$0,g,k,a)}return k[b].exports}for(var h="function"==typeof require&&require,f=0;f<a.length;f++)l(a[f]);return l})({1:[function(c,g,k){(function(a){var l=a.Twilio||function(){};
Object.assign(l,c("./twilio"));a.Twilio=l})("undefined"!==typeof window?window:global)},{"./twilio":2}],2:[function(c,g,k){k.Device=c("./twilio/device").Device;k.PStream=c("./twilio/pstream").PStream;k.Connection=c("./twilio/connection").Connection},{"./twilio/connection":4,"./twilio/device":5,"./twilio/pstream":11}],3:[function(c,g,k){function a(b,e,c,r){if(!(this instanceof a))return new a(b,e,c,r);d.call(this);r=Object.assign({AudioContext:"undefined"!==typeof AudioContext&&AudioContext,mediaDevices:n,
setSinkId:"undefined"!==typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId},r);m.mixinLog(this,"[AudioHelper]");this.log.enabled=r.logEnabled;this.log.warnings=r.logWarnings;var p=new Map,q=new Map,B=r.mediaDevices,t=B&&B.enumerateDevices||!1,u="function"===typeof r.setSinkId,k=t&&u,F=!(!r.AudioContext&&!r.audioContext);r.soundOptions&&h(this,r.soundOptions);var w=u=null;F&&(u=r.audioContext||new r.AudioContext,w=u.createAnalyser(),w.fftSize=32,w.smoothingTimeConstant=.3);var g=this;Object.defineProperties(this,
{_audioContext:{value:u},_getUserMedia:{value:c},_inputDevice:{value:null,writable:!0},_inputStream:{value:null,writable:!0},_inputVolumeAnalyser:{value:w},_isPollingInputVolume:{value:!1,writable:!0},_onActiveInputChanged:{value:e},_mediaDevices:{value:B},_unknownDeviceIndexes:{value:{}},_updateAvailableDevices:{value:f.bind(null,this)},availableInputDevices:{enumerable:!0,value:p},availableOutputDevices:{enumerable:!0,value:q},inputDevice:{enumerable:!0,get:function(){return g._inputDevice}},inputStream:{enumerable:!0,
get:function(){return g._inputStream}},isVolumeSupported:{enumerable:!0,value:F},isOutputSelectionSupported:{enumerable:!0,value:k},ringtoneDevices:{enumerable:!0,value:new v("ringtone",q,b,k)},speakerDevices:{enumerable:!0,value:new v("speaker",q,b,k)}});this.on("newListener",function(a){"inputVolume"===a&&g._maybeStartPollingVolume()});this.on("removeListener",function(a){"inputVolume"===a&&g._maybeStopPollingVolume()});this.once("newListener",function(){k||console.warn("Warning: This browser does not support audio output selection.");
F||console.warn("Warning: This browser does not support Twilio's volume indicator feature.")});t&&l(this)}function l(a){a._mediaDevices.addEventListener("devicechange",a._updateAvailableDevices);a._mediaDevices.addEventListener("deviceinfochange",a._updateAvailableDevices);f(a).then(function(){a.isOutputSelectionSupported&&Promise.all([a.speakerDevices.set("default"),a.ringtoneDevices.set("default")]).catch(function(d){a.log.warn("Warning: Unable to set audio output devices. "+d)})})}function h(a,
d){function n(a,d){"undefined"!==typeof d&&(m[a]=d);return m[a]}var m=d.__dict__;m&&Object.keys(m).forEach(function(d){a[d]=n.bind(null,d)})}function f(a){return a._mediaDevices.enumerateDevices().then(function(d){q(a,u(d,"audiooutput"),a.availableOutputDevices,b);q(a,u(d,"audioinput"),a.availableInputDevices,e);var n=a.availableOutputDevices.get("default")||Array.from(a.availableOutputDevices.values())[0];[a.speakerDevices,a.ringtoneDevices].forEach(function(d){!d.get().size&&a.availableOutputDevices.size&&
d.set(n.deviceId)})})}function b(a,d){return a.speakerDevices._delete(d)|a.ringtoneDevices._delete(d)}function e(a,d){if(!a.inputDevice||a.inputDevice.deviceId!==d.deviceId)return!1;t(a,null);a._inputDevice=null;a._maybeStopPollingVolume();(d=a.availableInputDevices.get("default")||Array.from(a.availableInputDevices.values())[0])&&a.setInputDevice(d.deviceId);return!0}function u(a,d){return a.filter(function(a){return a.kind===d})}function p(a){return a.deviceId}function q(a,d,n,m){var b=d.map(p),
e=Array.from(n.values()).map(p),f=[],b=w.difference(e,b);b.forEach(function(d){var b=n.get(d);n.delete(d);m(a,b)&&f.push(b)});var c=!1;d.forEach(function(d){var m=n.get(d.deviceId),b;b={deviceId:d.deviceId,groupId:d.groupId,kind:d.kind,label:d.label};if(!b.label)if("default"===b.deviceId)b.label="Default";else{var e=d.deviceId,f=d.kind,v=a._unknownDeviceIndexes;v[f]||(v[f]={});var p=v[f][e];p||(p=Object.keys(v[f]).length+1,v[f][e]=p);b.label="Unknown "+B[b.kind]+" Device "+p}b=new r(b);m&&m.label===
b.label||(n.set(d.deviceId,b),c=!0)});if(c||b.length)null!==a.inputDevice&&"default"===a.inputDevice.deviceId&&(a.log.warn("Calling getUserMedia after device change to ensure that the tracks of the active device (default) have not gone stale."),a._setInputDevice(a._inputDevice.deviceId,!0)),a.emit("deviceChange",f)}function t(a,d){a._inputStream&&a._inputStream.getTracks().forEach(function(a){a.stop()});a._inputStream=d}var d=c("events").EventEmitter;k=c("util").inherits;var m=c("./log"),r=c("./shims/mediadeviceinfo"),
n=c("./shims/mediadevices"),v=c("./outputdevicecollection"),w=c("./util");k(a,d);a.prototype._maybeStartPollingVolume=function(){if(this.isVolumeSupported&&this._inputStream&&(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),this._inputVolumeSource=null),this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser),!this._isPollingInputVolume)){var a=new Uint8Array(this._inputVolumeAnalyser.frequencyBinCount),
d=this;this._isPollingInputVolume=!0;requestAnimationFrame(function A(){if(d._isPollingInputVolume){d._inputVolumeAnalyser.getByteFrequencyData(a);var n=w.average(a);d.emit("inputVolume",n/255);requestAnimationFrame(A)}})}};a.prototype._maybeStopPollingVolume=function(){!this.isVolumeSupported||!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),this._inputVolumeSource=null),this._isPollingInputVolume=!1)};
a.prototype.setInputDevice=function(a){return w.isFirefox()?Promise.reject(Error("Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324")):this._setInputDevice(a,!1)};a.prototype._setInputDevice=function(a,d){if("string"!==typeof a)return Promise.reject(Error("Must specify the device to set"));
var n=this.availableInputDevices.get(a);if(!n)return Promise.reject(Error("Device not found: "+a));if(this._inputDevice&&this._inputDevice.deviceId===a&&this._inputStream){if(!d)return Promise.resolve();this._inputStream.getTracks().forEach(function(a){a.stop()})}var m=this;return this._getUserMedia({audio:{deviceId:{exact:a}}}).then(function(a){return m._onActiveInputChanged(a).then(function(){t(m,a);m._inputDevice=n;m._maybeStartPollingVolume()})})};a.prototype.unsetInputDevice=function(){if(!this.inputDevice)return Promise.resolve();
var a=this;return this._onActiveInputChanged(null).then(function(){t(a,null);a._inputDevice=null;a._maybeStopPollingVolume()})};a.prototype._unbind=function(){this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices);this._mediaDevices.removeEventListener("deviceinfochange",this._updateAvailableDevices)};var B={audiooutput:"Audio Output",audioinput:"Audio Input"};g.exports=a},{"./log":8,"./outputdevicecollection":10,"./shims/mediadeviceinfo":22,"./shims/mediadevices":23,
"./util":27,events:34,util:49}],4:[function(c,g,k){function a(m,c,n,v){function r(){}function p(){var a={call_sid:g.parameters.CallSid,client_name:m._clientName,sdk_version:u.getReleaseVersion(),selected_region:m.options.region};m.stream&&(m.stream.gateway&&(a.gateway=m.stream.gateway),m.stream.region&&(a.region=m.stream.region));a.direction=g._direction;return a}function q(){0!==y.length&&x.postMetrics("quality-metrics-samples","metrics-sample",y.splice(0),p())}function h(a){var d={threshold:a.threshold.value};
a.values?d.values=a.values.map(function(a){return"number"===typeof a?Math.round(100*a)/100:a}):a.value&&(d.value=a.value);return{data:d}}function k(a,n){var m=(/^audio/.test(n.name)?"audio-level-":"network-quality-")+"warning"+(a?"-cleared":"-raised"),b=d[n.threshold.name]+t[n.name];if("constant-audio-input-level"!==b||!g.isMuted()){var e=a?"info":"warning";"constant-audio-output-level"===b&&(e="info");x.post(e,m,b,h(n),g);"constant-audio-output-level"!==b&&g.emit(a?"warning-cleared":"warning",b)}}
if(!(this instanceof a))return new a(m,c,n,v);var g=this;u.monitorEventEmitter("Twilio.Connection",this);this._soundcache=m.soundcache;this.message=c||{};v=this.options=Object.assign({audioConstraints:m.options.audioConstraints,callParameters:{},debug:!1,encrypt:!1,iceServers:m.options.iceServers,logPrefix:"[Connection]",MediaStream:v.mediaStreamFactory||m.options.MediaStream||m.options.mediaStreamFactory||b.PeerConnection,offerSdp:null,rtcConstraints:m.options.rtcConstraints},v);this.parameters=
v.callParameters;this._status="pending";this._isAnswered=!1;this._direction=this.parameters.CallSid?"INCOMING":"OUTGOING";this.sendHangup=!0;f.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.log.warnings=this.options.warnings;this._onHangup=this._onCancel=r;var x=this._publisher=v.publisher;"INCOMING"===this._direction&&x.info("connection","incoming",null,this);var C=this._monitor=new e;C.disableWarnings();var y=[],D=0;C.on("sample",function(a){20>D?D++:20===D&&C.enableWarnings();
a.inputVolume=g._latestInputVolume;a.outputVolume=g._latestOutputVolume;y.push(a);10<=y.length&&q()});C.on("warning-cleared",k.bind(null,!0));C.on("warning",k.bind(null,!1));this.mediaStream=new this.options.MediaStream(m,n);this.on("volume",function(a,d){g._latestInputVolume=a;g._latestOutputVolume=d});this.mediaStream.onvolume=this.emit.bind(this,"volume");this.mediaStream.oniceconnectionstatechange=function(a){x.post("failed"===a?"error":"debug","ice-connection-state",a,null,g)};this.mediaStream.onicegatheringstatechange=
function(a){x.debug("signaling-state",a,null,g)};this.mediaStream.onsignalingstatechange=function(a){x.debug("signaling-state",a,null,g)};this.mediaStream.ondisconnect=function(a){g.log(a);x.warn("network-quality-warning-raised","ice-connectivity-lost",{message:a},g);g.emit("warning","ice-connectivity-lost")};this.mediaStream.onreconnect=function(a){g.log(a);x.info("network-quality-warning-cleared","ice-connectivity-lost",{message:a},g);g.emit("warning-cleared","ice-connectivity-lost")};this.mediaStream.onerror=
function(a){!0===a.disconnect&&g._disconnect(a.info&&a.info.message);var d={code:a.info.code,message:a.info.message||"Error with mediastream",info:a.info,connection:g};g.log("Received an error from MediaStream:",a);g.emit("error",d)};this.mediaStream.onopen=function(){"open"!==g._status&&("ringing"===g._status||"connecting"===g._status?(g.mute(!1),g._maybeTransitionToOpen()):g.mediaStream.close())};this.mediaStream.onclose=function(){g._status="closed";m.sounds.__dict__.disconnect&&m.soundcache.get("disconnect").play();
C.disable();q();g.emit("disconnect",g)};this.outboundConnectionId=u.generateConnectionUUID();this.pstream=m.stream;this._onCancel=function(a){g.parameters.CallSid===a.callsid&&(g._status="closed",g.emit("cancel"),g.pstream.removeListener("cancel",g._onCancel))};this.pstream&&(this.pstream.on("cancel",this._onCancel),this.pstream.on("ringing",this._onRinging.bind(this)));this.on("error",function(a){x.error("connection","error",{code:a.code,message:a.message},g);g.pstream&&"disconnected"===g.pstream.status&&
l(g)});this.on("disconnect",function(){l(g)});return this}function l(a){function d(){a.pstream&&(a.pstream.removeListener("cancel",a._onCancel),a.pstream.removeListener("hangup",a._onHangup))}d();setTimeout(d,0)}g=c("events").EventEmitter;var h=c("./util").Exception,f=c("./log"),b=c("./rtc"),e=c("./rtc/monitor"),u=c("./util"),p=[1,2,3,4,5],q="one-way-audio choppy-audio dropped-call audio-latency noisy-call echo".split(" "),t={audioOutputLevel:"audio-output-level",audioInputLevel:"audio-input-level",
packetsLostFraction:"packet-loss",jitter:"jitter",rtt:"rtt",mos:"mos"},d={min:"low-",max:"high-",maxDuration:"constant-"};c("util").inherits(a,g);a.toString=function(){return"[Twilio.Connection class]"};a.prototype.toString=function(){return"[Twilio.Connection instance]"};a.prototype.sendDigits=function(a){function d(a){if(a.length){var n=a.shift();n.length&&b.insertDTMF(n,160,70);setTimeout(d.bind(null,a),500)}}if(a.match(/[^0-9*#w]/))throw new h("Illegal character passed into sendDigits");var n=
[];a.split("").forEach(function(a){a="w"!==a?"dtmf"+a:"";"dtmf*"===a&&(a="dtmfs");"dtmf#"===a&&(a="dtmfh");n.push(a)});(function B(a){var d=n.shift();a.get(d).play();n.length&&setTimeout(B.bind(null,a),200)})(this._soundcache);var b=this.mediaStream.getOrCreateDTMFSender();if(b){if(!("canInsertDTMF"in b)||b.canInsertDTMF){this.log("Sending digits using RTCDTMFSender");d(a.split("w"));return}this.log("RTCDTMFSender cannot insert DTMF")}this.log("Sending digits over PStream");null!==this.pstream&&"disconnected"!==
this.pstream.status?(a={dtmf:a,callsid:this.parameters.CallSid},this.pstream.publish("dtmf",a)):(a={error:{}},this.emit("error",{code:a.error.code||31E3,message:a.error.message||"Could not send DTMF: Signaling channel is disconnected",connection:this}))};a.prototype.status=function(){return this._status};a.prototype.mute=function(a){if("undefined"===typeof a)a=!0,this.log.deprecated(".mute() is deprecated. Please use .mute(true) or .mute(false) to mute or unmute a call instead.");else if("function"===
typeof a){this.addListener("mute",a);return}this.isMuted()!==a&&(this.mediaStream.mute(a),a=this.isMuted(),this._publisher.info("connection",a?"muted":"unmuted",null,this),this.emit("mute",a,this))};a.prototype.isMuted=function(){return this.mediaStream.isMuted};a.prototype.unmute=function(){this.log.deprecated(".unmute() is deprecated. Please use .mute(false) to unmute a call instead.");this.mute(!1)};a.prototype.accept=function(a){function d(){function a(a){b._publisher.info("connection","accepted-by-local",
null,b);b._monitor.enable(a)}function d(a){b._publisher.info("connection","accepted-by-remote",null,b);b._monitor.enable(a)}if("connecting"!==b._status)l(b),b.mediaStream.close();else{var n=[],m;for(m in b.message)n.push(encodeURIComponent(m)+"="+encodeURIComponent(b.message[m]));m="function"===typeof b.options.getSinkIds&&b.options.getSinkIds();Array.isArray(m)&&b.mediaStream._setSinkIds(m).catch(function(){});n=n.join("&");"INCOMING"===b._direction?(b._isAnswered=!0,b.mediaStream.answerIncomingCall(b.parameters.CallSid,
b.options.offerSdp,b.options.rtcConstraints,b.options.iceServers,a)):(b.pstream.once("answer",b._onAnswer.bind(b)),b.mediaStream.makeOutgoingCall(b.pstream.token,n,b.outboundConnectionId,b.options.rtcConstraints,b.options.iceServers,d));b._onHangup=function(a){if(a.callsid&&(b.parameters.CallSid||b.outboundConnectionId)){if(a.callsid!==b.parameters.CallSid&&a.callsid!==b.outboundConnectionId)return}else if(a.callsid)return;b.log("Received HANGUP from gateway");a.error&&(a={code:a.error.code||31E3,
message:a.error.message||"Error sent from gateway in HANGUP",connection:b},b.log("Received an error from the gateway:",a),b.emit("error",a));b.sendHangup=!1;b._publisher.info("connection","disconnected-by-remote",null,b);b._disconnect(null,!0);l(b)};b.pstream.addListener("hangup",b._onHangup)}}if("function"===typeof a)this.addListener("accept",a);else if("pending"===this._status){var n=a||this.options.audioConstraints,b=this;this._status="connecting";a="function"===typeof this.options.getInputStream&&
this.options.getInputStream();(a?this.mediaStream.openWithStream(a):this.mediaStream.openWithConstraints(n)).then(function(){b._publisher.info("get-user-media","succeeded",{data:{audioConstraints:n}},b);d()},function(a){var d,m;a.code&&a.code===a.PERMISSION_DENIED||a.name&&"PermissionDeniedError"===a.name?(m=31208,d="User denied access to microphone, or the web browser did not allow microphone access at this address.",b._publisher.error("get-user-media","denied",{data:{audioConstraints:n,error:a}},
b)):(m=31201,d="Error occurred while accessing microphone: "+a.name+(a.message?" ("+a.message+")":""),b._publisher.error("get-user-media","failed",{data:{audioConstraints:n,error:a}},b));return b._die(d,m)})}};a.prototype.reject=function(a){"function"===typeof a?this.addListener("reject",a):"pending"===this._status&&(this.pstream.publish("reject",{callsid:this.parameters.CallSid}),this.emit("reject"),this.mediaStream.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",
null,this))};a.prototype.ignore=function(a){"function"===typeof a?this.addListener("cancel",a):"pending"===this._status&&(this._status="closed",this.emit("cancel"),this.mediaStream.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this))};a.prototype.cancel=function(a){this.log.deprecated(".cancel() is deprecated. Please use .ignore() instead.");this.ignore(a)};a.prototype.disconnect=function(a){"function"===typeof a?this.addListener("disconnect",a):this._disconnect()};
a.prototype._disconnect=function(a,d){a="string"===typeof a?a:null;if("open"===this._status||"connecting"===this._status||"ringing"===this._status){this.log("Disconnecting...");if(null!==this.pstream&&"disconnected"!==this.pstream.status&&this.sendHangup){var b=this.parameters.CallSid||this.outboundConnectionId;b&&(b={callsid:b},a&&(b.message=a),this.pstream.publish("hangup",b))}l(this);this.mediaStream.close();d||this._publisher.info("connection","disconnected-by-local",null,this)}};a.prototype.error=
function(a){"function"===typeof a&&this.addListener("error",a)};a.prototype._die=function(a,d){this._disconnect();this.emit("error",{message:a,code:d})};a.prototype._setCallSid=function(a){if(a=a.callsid)this.parameters.CallSid=a,this.mediaStream.callSid=a};a.prototype._setSinkIds=function(a){return this.mediaStream._setSinkIds(a)};a.prototype._setInputTracksFromStream=function(a){return this.mediaStream.setInputTracksFromStream(a)};a.prototype._onRinging=function(a){this._setCallSid(a);if("connecting"===
this._status||"ringing"===this._status){var d=!!a.sdp;this.options.enableRingingState?(this._status="ringing",this._publisher.info("connection","outgoing-ringing",{hasEarlyMedia:d},this),this.emit("ringing",d)):d&&this._onAnswer(a)}};a.prototype._onAnswer=function(a){this._isAnswered||(this._setCallSid(a),this._isAnswered=!0,this._maybeTransitionToOpen())};a.prototype._maybeTransitionToOpen=function(){this.mediaStream&&"open"===this.mediaStream.status&&this._isAnswered&&(this._status="open",this.emit("accept",
this))};a.prototype.volume=function(a){if(!window||!window.AudioContext&&!window.webkitAudioContext)console.warn("This browser does not support Connection.volume");else if("function"===typeof a)this.on("volume",a)};a.prototype.getLocalStream=function(){return this.mediaStream&&this.mediaStream.stream};a.prototype.getRemoteStream=function(){return this.mediaStream&&this.mediaStream._remoteStream};a.prototype.postFeedback=function(a,d){if("undefined"===typeof a||null===a)return this._postFeedbackDeclined();
if(-1===p.indexOf(a))throw Error("Feedback score must be one of: "+p);if("undefined"!==typeof d&&null!==d&&-1===q.indexOf(d))throw Error("Feedback issue must be one of: "+q);return this._publisher.post("info","feedback","received",{quality_score:a,issue_name:d},this,!0)};a.prototype._postFeedbackDeclined=function(){return this._publisher.post("info","feedback","received-none",null,this,!0)};a.prototype._getTempCallSid=function(){return this.outboundConnectionId};a.prototype._getRealCallSid=function(){return/^TJ/.test(this.parameters.CallSid)?
null:this.parameters.CallSid};k.Connection=a},{"./log":8,"./rtc":14,"./rtc/monitor":16,"./util":27,events:34,util:49}],5:[function(c,g,k){function a(n,f){function c(a){a=a.forEach?a:[a];Array.from(z.soundcache.entries()).forEach(function(d){"incoming"!==d[0]&&d[1].setSinkIds(a)});z._connectionSinkIds=a;var d=z._activeConnection;return d?d._setSinkIds(a):Promise.resolve()}function v(a){return Promise.resolve(z.soundcache.get("incoming").setSinkIds(a))}function l(a){if(z._activeConnection){var d=!0===
I?"A call is currently in-progress. Leaving or reloading this page will end the call.":I;return(a||window.event).returnValue=d}}function k(){z.disconnectAll()}if(!u.enabled())throw new e.Exception("twilio.js 1.3 requires WebRTC/ORTC browser support. For more information, see <https://www.twilio.com/docs/api/client/twilio-js>. If you have any questions about this announcement, please contact Twilio Support at <help@twilio.com>.");if(!(this instanceof a))return new a(n,f);e.monitorEventEmitter("Twilio.Device",
this);if(!n)throw new e.Exception("Capability token is not valid or missing.");f=f||{};for(var g in f);var A={logPrefix:"[Device]",chunderw:"chunderw-vpc-gll.twilio.com",eventgw:"eventgw.twilio.com",Sound:f.soundFactory||t,connectionFactory:d,pStreamFactory:r,noRegister:!1,encrypt:!1,closeProtection:!1,secureSignaling:!0,warnings:!0,audioConstraints:!0,iceServers:[],region:"gll",dscp:!0,sounds:{}};f=f||{};g=f.chunderw;for(var x in A)x in f||(f[x]=A[x]);f.rtcConstraints=f.dscp?{optional:[{googDscp:!0}]}:
{};this.options=f;this.token=n;this._region=this._status="offline";this._connectionSinkIds=["default"];this._connectionInputStream=null;this.connections=[];this._activeConnection=null;this.sounds=new q({incoming:!0,outgoing:!0,disconnect:!0});b.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;n={gll:"chunderw-vpc-gll.twilio.com",au1:"chunderw-vpc-gll-au1.twilio.com",br1:"chunderw-vpc-gll-br1.twilio.com",de1:"chunderw-vpc-gll-de1.twilio.com",ie1:"chunderw-vpc-gll-ie1.twilio.com",
jp1:"chunderw-vpc-gll-jp1.twilio.com",sg1:"chunderw-vpc-gll-sg1.twilio.com",us1:"chunderw-vpc-gll-us1.twilio.com","us1-tnx":"chunderw-vpc-gll-us1-tnx.twilio.com","us2-tnx":"chunderw-vpc-gll-us2-tnx.twilio.com","ie1-tnx":"chunderw-vpc-gll-ie1-tnx.twilio.com","us1-ix":"chunderw-vpc-gll-us1-ix.twilio.com","us2-ix":"chunderw-vpc-gll-us2-ix.twilio.com","ie1-ix":"chunderw-vpc-gll-ie1-ix.twilio.com"};x={au:"au1",br:"br1",ie:"ie1",jp:"jp1",sg:"sg1","us-va":"us1","us-or":"us1"};A=f.region.toLowerCase();A in
x&&(this.log.deprecated("Region "+A+" is deprecated, please use "+x[A]+"."),A=x[A]);if(!(A in n))throw new e.Exception("Region "+f.region+" is invalid. Valid values are: "+Object.keys(n).join(", "));f.chunderw=g||n[A];this.soundcache=new Map;g="undefined"!==typeof document?document.createElement("audio"):{};var C;try{C=g.canPlayType&&!!g.canPlayType("audio/mpeg").replace(/no/,"")}catch(J){C=!1}var y;try{y=g.canPlayType&&!!g.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch(J){y=!1}g=
"mp3";y&&!C&&(g="ogg");C={incoming:{filename:"incoming",shouldLoop:!0},outgoing:{filename:"outgoing",maxDuration:3E3},disconnect:{filename:"disconnect",maxDuration:3E3},dtmf1:{filename:"dtmf-1",maxDuration:1E3},dtmf2:{filename:"dtmf-2",maxDuration:1E3},dtmf3:{filename:"dtmf-3",maxDuration:1E3},dtmf4:{filename:"dtmf-4",maxDuration:1E3},dtmf5:{filename:"dtmf-5",maxDuration:1E3},dtmf6:{filename:"dtmf-6",maxDuration:1E3},dtmf7:{filename:"dtmf-7",maxDuration:1E3},dtmf8:{filename:"dtmf-8",maxDuration:1E3},
dtmf9:{filename:"dtmf-9",maxDuration:1E3},dtmf0:{filename:"dtmf-0",maxDuration:1E3},dtmfs:{filename:"dtmf-star",maxDuration:1E3},dtmfh:{filename:"dtmf-hash",maxDuration:1E3}};y=e.getTwilioRoot()+"sounds/releases/"+e.getSoundVersion()+"/";for(var D in C)n=C[D],x=y+n.filename+"."+g+"?cache=1_4_23",n=new this.options.Sound(D,f.sounds[D]||x,{maxDuration:n.maxDuration,minDuration:n.minDuration,shouldLoop:n.shouldLoop,audioContext:this.options.disableAudioContextSounds?null:a.audioContext}),this.soundcache.set(D,
n);var z=this,E=this._publisher=new p("twilio-js-sdk",this.token,{host:this.options.eventgw,defaultPayload:function(a){var d={client_name:z._clientName,platform:u.getMediaEngine(),sdk_version:e.getReleaseVersion(),selected_region:z.options.region};if(a){var b=a._getRealCallSid();b&&(d.call_sid=b);(b=a._getTempCallSid())&&(d.temp_call_sid=b);d.direction=a._direction}if(a=z.stream)(b=a.gateway)&&(d.gateway=b),(a=a.region)&&(d.region=a);return d}});!1===f.publishEvents&&E.disable();(this.audio=new h(function(a,
d){return("ringtone"===a?v(d):c(d)).then(function(){E.info("audio",a+"-devices-set",{audio_device_ids:d},z._activeConnection)},function(b){E.error("audio",a+"-devices-set-failed",{audio_device_ids:d,message:b.message},z._activeConnection);throw b;})},function(a){var d=z._activeConnection;if(d&&!a)return Promise.reject(Error("Cannot unset input device while a call is in progress."));z._connectionInputStream=a;return d?d._setInputTracksFromStream(a):Promise.resolve()},m,{audioContext:a.audioContext,
logEnabled:!!this.options.debug,logWarnings:!!this.options.warnings,soundOptions:this.sounds})).on("deviceChange",function(a){var d=z._activeConnection;a=a.map(function(a){return a.deviceId});E.info("audio","device-change",{lost_active_device_ids:a},d);d&&d.mediaStream._onInputDevicesChanged()});this.mediaPresence={audio:!this.options.noRegister};this.register(this.token);var I=this.options.closeProtection;I&&"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("beforeunload",
l):window.attachEvent&&window.attachEvent("onbeforeunload",l));"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("unload",k):window.attachEvent&&window.attachEvent("onunload",k));this.on("error",function(){});return this}function l(a,d,b){var n={getSinkIds:function(){return a._connectionSinkIds},getInputStream:function(){return a._connectionInputStream},debug:a.options.debug,encrypt:a.options.encrypt,warnings:a.options.warnings,publisher:a._publisher,enableRingingState:a.options.enableRingingState};
b=b||{};for(var f in n)f in b||(b[f]=n[f]);var e=a.options.connectionFactory(a,d,m,b);e.once("accept",function(){a._activeConnection=e;a._removeConnection(e);a.audio._maybeStartPollingVolume();a.emit("connect",e)});e.addListener("error",function(d){"closed"===e.status()&&a._removeConnection(e);a.audio._maybeStopPollingVolume();a.emit("error",d)});e.once("cancel",function(){a.log("Canceled: "+e.parameters.CallSid);a._removeConnection(e);a.audio._maybeStopPollingVolume();a.emit("cancel",e)});e.once("disconnect",
function(){a.audio._maybeStopPollingVolume();a._removeConnection(e);a._activeConnection===e&&(a._activeConnection=null);a.emit("disconnect",e)});e.once("reject",function(){a.log("Rejected: "+e.parameters.CallSid);a.audio._maybeStopPollingVolume();a._removeConnection(e)});return e}var h=c("./audiohelper");g=c("events").EventEmitter;var f=c("util"),b=c("./log"),e=c("./util"),u=c("./rtc"),p=c("./eventpublisher"),q=c("./options").Options,t=c("./sound"),d=c("./connection").Connection,m=c("./rtc/getusermedia"),
r=c("./pstream").PStream;f.inherits(a,g);a.toString=function(){return"[Twilio.Device class]"};a.prototype.toString=function(){return"[Twilio.Device instance]"};a.prototype.register=function(a){var d=e.objectize(a);this._accountSid=d.iss;this._clientName=d.scope["client:incoming"]?d.scope["client:incoming"].params.clientName:null;this.stream?(this.stream.setToken(a),this._publisher.setToken(a)):this._setupStream(a)};a.prototype.registerPresence=function(){this.token&&(e.objectize(this.token).scope["client:incoming"]&&
(this.mediaPresence.audio=!0),this._sendPresence())};a.prototype.unregisterPresence=function(){this.mediaPresence.audio=!1;this._sendPresence()};a.prototype.connect=function(a,d){if("function"===typeof a)return this.addListener("connect",a);if(this._activeConnection)throw Error("A Connection is already active");a=a||{};d=d||this.options.audioConstraints;a=this._activeConnection=l(this,a);this.connections.splice(0).forEach(function(a){a.ignore()});this.soundcache.get("incoming").stop();if(this.sounds.__dict__.outgoing){var b=
this;a.accept(function(){b.soundcache.get("outgoing").play()})}a.accept(d);return a};a.prototype.disconnectAll=function(){for(var a=[].concat(this.connections),d=0;d<a.length;d++)a[d].disconnect();this._activeConnection&&this._activeConnection.disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)};a.prototype.destroy=function(){this._stopRegistrationTimer();this.audio._unbind();this.stream&&(this.stream.destroy(),this.stream=null)};a.prototype.disconnect=
function(a){this.addListener("disconnect",a)};a.prototype.incoming=function(a){this.addListener("incoming",a)};a.prototype.offline=function(a){this.addListener("offline",a)};a.prototype.ready=function(a){this.addListener("ready",a)};a.prototype.error=function(a){this.addListener("error",a)};a.prototype.status=function(){return this._activeConnection?"busy":this._status};a.prototype.activeConnection=function(){return this._activeConnection||this.connections[0]};a.prototype.region=function(){return this._region};
a.prototype._sendPresence=function(){this.stream&&(this.stream.register(this.mediaPresence),this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer())};a.prototype._startRegistrationTimer=function(){clearTimeout(this.regTimer);var a=this;this.regTimer=setTimeout(function(){a._sendPresence()},3E4)};a.prototype._stopRegistrationTimer=function(){clearTimeout(this.regTimer)};a.prototype._setupStream=function(a){var d=this;this.log("Setting up PStream");this.stream=this.options.pStreamFactory(a,
{chunderw:this.options.chunderw,debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.stream.addListener("connected",function(a){d._region={US_EAST_VIRGINIA:"us1",US_WEST_OREGON:"us2",ASIAPAC_SYDNEY:"au1",SOUTH_AMERICA_SAO_PAULO:"br1",EU_IRELAND:"ie1",ASIAPAC_TOKYO:"jp1",ASIAPAC_SINGAPORE:"sg1"}[a.region]||a.region;d._sendPresence()});this.stream.addListener("close",function(){d.stream=null});this.stream.addListener("ready",function(){d.log("Stream is ready");"offline"===d._status&&
(d._status="ready");d.emit("ready",d)});this.stream.addListener("offline",function(){d.log("Stream is offline");d._status="offline";d._region="offline";d.emit("offline",d)});this.stream.addListener("error",function(a){var b=a.error;b&&(a.callsid&&(b.connection=d._findConnection(a.callsid)),31205===b.code&&d._stopRegistrationTimer(),d.log("Received error: ",b),d.emit("error",b))});this.stream.addListener("invite",function(a){function b(){d.connections.length||d.soundcache.get("incoming").stop()}if(d._activeConnection)d.log("Device busy; ignoring incoming invite");
else if(a.callsid&&a.sdp){var e=a.parameters||{};e.CallSid=e.CallSid||a.callsid;var f=l(d,{},{offerSdp:a.sdp,callParameters:e});d.connections.push(f);f.once("accept",function(){d.soundcache.get("incoming").stop()});["cancel","error","reject"].forEach(function(a){f.once(a,b)});d._showIncomingConnection(f,d.sounds.__dict__.incoming?function(){return d.soundcache.get("incoming").play()}:function(){return Promise.resolve()})}else d.emit("error",{message:"Malformed invite from gateway"})})};a.prototype._showIncomingConnection=
function(a,d){var b=this,e;return Promise.race([d(),new Promise(function(a,d){e=setTimeout(function(){d(Error("Playing incoming ringtone took too long; it might not play. Continuing execution..."))},2E3)})]).catch(function(a){console.warn(a.message)}).then(function(){clearTimeout(e);b.emit("incoming",a)})};a.prototype._removeConnection=function(a){for(var d=this.connections.length-1;0<=d;d--)a===this.connections[d]&&this.connections.splice(d,1)};a.prototype._findConnection=function(a){for(var d=0;d<
this.connections.length;d++){var b=this.connections[d];if(b.parameters.CallSid===a||b.outboundConnectionId===a)return b}return null};k.Device=function(d){function b(a){d.instance?a():c.push(a)}function f(a){a=(a.code?a.code+": ":"")+a.message;if(d.instance){for(var b=0,m=d.instance.listeners("error"),c=0;c<m.length;c++)m[c]!==f&&b++;if(1<b)return;d.instance.log(a)}throw new e.Exception(a);}var m=[],c=[],n={instance:null,setup:function(b,e){d.audioContext||("undefined"!==typeof AudioContext?d.audioContext=
new AudioContext:"undefined"!==typeof webkitAudioContext&&(d.audioContext=new webkitAudioContext));var n;if(d.instance)d.instance.log("Found existing Device; using new token but ignoring options"),d.instance.token=b,d.instance.register(b);else{d.instance=new a(b,e);d.error(f);d.sounds=d.instance.sounds;for(n=0;n<c.length;n++)c[n]();c=[]}for(n=0;n<m.length;n++)m[n](b,e);m=[];return d},connect:function(a,f){if("function"===typeof a)return b(function(){d.instance.addListener("connect",a)}),null;if(!d.instance)throw new e.Exception("Run Twilio.Device.setup()");
return 0<d.instance.connections.length?(d.instance.emit("error",{message:"A connection is currently active"}),null):d.instance.connect(a,f)},disconnectAll:function(){b(function(){d.instance.disconnectAll()});return d},disconnect:function(a){b(function(){d.instance.addListener("disconnect",a)});return d},status:function(){if(!d.instance)throw new e.Exception("Run Twilio.Device.setup()");return d.instance.status()},region:function(){if(!d.instance)throw new e.Exception("Run Twilio.Device.setup()");
return d.instance.region()},ready:function(a){b(function(){d.instance.addListener("ready",a)});return d},error:function(a){b(function(){a!==f&&d.instance.removeListener("error",f);d.instance.addListener("error",a)});return d},offline:function(a){b(function(){d.instance.addListener("offline",a)});return d},incoming:function(a){b(function(){d.instance.addListener("incoming",a)});return d},destroy:function(){d.instance&&d.instance.destroy();return d},cancel:function(a){b(function(){d.instance.addListener("cancel",
a)});return d},activeConnection:function(){return d.instance?d.instance.activeConnection():null}},p;for(p in n)d[p]=n[p];Object.defineProperties(d,{audio:{get:function(){return d.instance.audio}}});return d}(a)},{"./audiohelper":3,"./connection":4,"./eventpublisher":6,"./log":8,"./options":9,"./pstream":11,"./rtc":14,"./rtc/getusermedia":13,"./sound":24,"./util":27,events:34,util:49}],6:[function(c,g,k){function a(f,b,e){if(!(this instanceof a))return new a(f,b,e);e=Object.assign({defaultPayload:function(){return{}},
host:"eventgw.twilio.com"},e);var c=e.defaultPayload;"function"!==typeof c&&(c=function(){return Object.assign({},e.defaultPayload)});var p=!0;Object.defineProperties(this,{_defaultPayload:{value:c},_isEnabled:{get:function(){return p},set:function(a){p=a}},_host:{value:e.host},_request:{value:e.request||h},_token:{value:b,writable:!0},isEnabled:{enumerable:!0,get:function(){return p}},productName:{enumerable:!0,value:f},token:{enumerable:!0,get:function(){return this._token}}})}function l(a){return{timestamp:(new Date(a.timestamp)).toISOString(),
total_packets_received:a.totals.packetsReceived,total_packets_lost:a.totals.packetsLost,total_packets_sent:a.totals.packetsSent,total_bytes_received:a.totals.bytesReceived,total_bytes_sent:a.totals.bytesSent,packets_received:a.packetsReceived,packets_lost:a.packetsLost,packets_lost_fraction:a.packetsLostFraction&&Math.round(100*a.packetsLostFraction)/100,audio_level_in:a.audioInputLevel,audio_level_out:a.audioOutputLevel,call_volume_input:a.inputVolume,call_volume_output:a.outputVolume,jitter:a.jitter,
rtt:a.rtt,mos:a.mos&&Math.round(100*a.mos)/100}}var h=c("./request");a.prototype._post=function(a,b,e,c,p,q,h){if(!this.isEnabled&&!h)return Promise.resolve();b={publisher:this.productName,group:e,name:c,timestamp:(new Date).toISOString(),level:b.toUpperCase(),payload_type:"application/json",private:!1,payload:p&&p.forEach?p.slice(0):Object.assign(this._defaultPayload(q),p)};var d={url:"https://"+this._host+"/v2/"+a,body:b,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token}},f=
this;return new Promise(function(a,b){f._request.post(d,function(d){d?b(d):a()})})};a.prototype.post=function(a,b,e,c,p,q){return this._post("EndpointEvents",a,b,e,c,p,q)};a.prototype.debug=function(a,b,e,c){return this.post("debug",a,b,e,c)};a.prototype.info=function(a,b,e,c){return this.post("info",a,b,e,c)};a.prototype.warn=function(a,b,e,c){return this.post("warning",a,b,e,c)};a.prototype.error=function(a,b,e,c){return this.post("error",a,b,e,c)};a.prototype.postMetrics=function(a,b,e,c){e=e.map(l).map(function(a){return Object.assign(a,
c)});return this._post("EndpointMetrics","info",a,b,e)};a.prototype.setToken=function(a){this._token=a};a.prototype.enable=function(){this._isEnabled=!0};a.prototype.disable=function(){this._isEnabled=!1};g.exports=a},{"./request":12}],7:[function(c,g,k){function a(c){function h(){}if(!(this instanceof a))return new a(c);c=c||{};var f={interval:10,now:function(){return(new Date).getTime()},repeat:function(a,b){return setInterval(a,b)},stop:function(a,b){return clearInterval(a,b)},onsleep:h,onwakeup:h},
b;for(b in f)b in c||(c[b]=f[b]);this.interval=c.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=c.onsleep;this.onwakeup=c.onwakeup;this.repeat=c.repeat;this.stop=c.stop;this.now=c.now}a.toString=function(){return"[Twilio.Heartbeat class]"};a.prototype.toString=function(){return"[Twilio.Heartbeat instance]"};a.prototype.beat=function(){this.lastbeat=this.now();if(this.sleeping()){if(this.onwakeup)this.onwakeup();var a=this;this.pintvl=this.repeat.call(null,function(){a.check()},1E3*this.interval)}};
a.prototype.check=function(){var a=this.now()-this.lastbeat;if(!this.sleeping()&&a>=1E3*this.interval){if(this.onsleep)this.onsleep();this.stop.call(null,this.pintvl);this.pintvl=null}};a.prototype.sleeping=function(){return null===this.pintvl};k.Heartbeat=a},{}],8:[function(c,g,k){k.mixinLog=function(a,c){function h(){if(h.enabled)for(var a=h.prefix?h.prefix+" ":"",e=0;e<arguments.length;e++){var c=arguments[e];h.handler("string"===typeof c?a+c:c)}}function f(){if(h.warnings)for(var a=0;a<arguments.length;a++)h.warnHandler(arguments[a])}
h.enabled=!0;h.prefix=c||"";h.defaultHandler=function(a){"undefined"!==typeof console&&console.log(a)};h.handler=h.defaultHandler;h.warnings=!0;h.defaultWarnHandler=function(a){"undefined"!==typeof console&&("function"===typeof console.warn?console.warn(a):"function"===typeof console.log&&console.log(a))};h.warnHandler=h.defaultWarnHandler;h.deprecated=f;h.warn=f;a.log=h}},{}],9:[function(c,g,k){var a=c("./log"),l=c("./strings").SOUNDS_DEPRECATION_WARNING;k.Options=function(){function c(f,b){function e(a,
b,d){return function(c,e){e||h||(h=!0,d.deprecated(l));"undefined"!==typeof c&&(a[b]=c);return a[b]}}if(!(this instanceof c))return new c(f);this.__dict__={};f=f||{};b=b||{};a.mixinLog(this,"[Sounds]");var h=!1,p;for(p in f)this[p]=e(this.__dict__,p,this.log),this[p](f[p],!0);for(p in b)this[p](b[p],!0)}return c}()},{"./log":8,"./strings":26}],10:[function(c,g,k){function a(a,c,b,e){Object.defineProperties(this,{_activeDevices:{value:new Set},_availableDevices:{value:c},_beforeChange:{value:b},_isSupported:{value:e},
_name:{value:a}})}c=c("./util");var l=c.getTwilioRoot()+"sounds/releases/"+c.getSoundVersion()+"/outgoing.mp3";a.prototype._delete=function(a){a=this._activeDevices.delete(a);var c=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&c&&this._activeDevices.add(c);c=Array.from(this._activeDevices).map(function(a){return a.deviceId});this._beforeChange(this._name,c);return a};a.prototype.get=function(){return this._activeDevices};a.prototype.set=
function(a){if(!this._isSupported)return Promise.reject(Error("This browser does not support audio output selection"));a=Array.isArray(a)?a:[a];if(!a.length)return Promise.reject(Error("Must specify at least one device to set"));var c=[],b=a.map(function(a){var b=this._availableDevices.get(a);b||c.push(a);return b},this);if(c.length)return Promise.reject(Error("Devices not found: "+c.join(", ")));var e=this;return(new Promise(function(b){b(e._beforeChange(e._name,a))})).then(function(){e._activeDevices.clear();
b.forEach(e._activeDevices.add,e._activeDevices)})};a.prototype.test=function(a){if(!this._isSupported)return Promise.reject(Error("This browser does not support audio output selection"));a=a||l;return this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map(function(c){var b=new Audio([a]);return b.setSinkId(c.deviceId).then(function(){return b.play()})})):Promise.reject(Error("No active output devices to test"))};g.exports=a},{"./util":27}],11:[function(c,g,k){function a(c,l){if(!(this instanceof
a))return new a(c,l);f.monitorEventEmitter("Twilio.PStream",this);var e={logPrefix:"[PStream]",chunderw:"chunderw-vpc-gll.twilio.com",secureSignaling:!0,transportFactory:b,debug:!1};l=l||{};for(var q in e)q in l||(l[q]=e[q]);this.options=l;this.token=c||"";this.status="disconnected";this.host=this.options.chunderw;this.region=this.gateway=null;h.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.on("error",function(){});var g=this;this.addListener("ready",function(){g.status=
"ready"});this.addListener("offline",function(){g.status="offline"});this.addListener("close",function(){g.destroy()});this.transport=this.options.transportFactory({host:this.host,debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.transport.onopen=function(){g.status="connected";g.setToken(g.token)};this.transport.onclose=function(){"disconnected"!==g.status&&("offline"!==g.status&&g.emit("offline",g),g.status="disconnected")};this.transport.onerror=function(a){g.emit("error",
a)};this.transport.onmessage=function(a){a=f.splitObjects(a.data);for(var d=0;d<a.length;d++){var b=JSON.parse(a[d]),c=b.type,b=b.payload||{};b.gateway&&(g.gateway=b.gateway);b.region&&(g.region=b.region);g.emit(c,b)}};this.transport.open();return this}g=c("events").EventEmitter;var l=c("util"),h=c("./log"),f=c("./util"),b=c("./wstransport").WSTransport;l.inherits(a,g);a.toString=function(){return"[Twilio.PStream class]"};a.prototype.toString=function(){return"[Twilio.PStream instance]"};a.prototype.setToken=
function(a){this.log("Setting token and publishing listen");this.token=a;a={token:a,browserinfo:f.getSystemInfo()};this.publish("listen",a)};a.prototype.register=function(a){this.publish("register",{media:a})};a.prototype.destroy=function(){this.log("Closing PStream");this.transport.close();return this};a.prototype.publish=function(a,b){a=JSON.stringify({type:a,version:f.getPStreamVersion(),payload:b});this.transport.send(a)};k.PStream=a},{"./log":8,"./util":27,"./wstransport":28,events:34,util:49}],
12:[function(c,g,k){var a="undefined"===typeof XMLHttpRequest?c("xmlhttprequest").XMLHttpRequest:XMLHttpRequest;c=function(c,h,f){var b;b=b||a;var e=new b;e.open(c,h.url,!0);e.onreadystatechange=function(){4===e.readyState&&(200<=e.status&&300>e.status?f(null,e.responseText):f(Error(e.responseText)))};for(var l in h.headers)e.setRequestHeader(l,h.headers[l]);e.send(JSON.stringify(h.body))};c.get=function(a,c){return new this("GET",a,c)};c.post=function(a,c){return new this("POST",a,c)};g.exports=
c},{xmlhttprequest:50}],13:[function(c,g,k){var a=c("../util");g.exports=function(c,h){h=h||{};h.util=h.util||a;h.navigator=h.navigator||("undefined"!==typeof navigator?navigator:null);return(new Promise(function(a,b){if(!h.navigator)throw Error("getUserMedia is not supported");switch("function"){case typeof(h.navigator.mediaDevices&&h.navigator.mediaDevices.getUserMedia):return a(h.navigator.mediaDevices.getUserMedia(c));case typeof h.navigator.webkitGetUserMedia:return h.navigator.webkitGetUserMedia(c,
a,b);case typeof h.navigator.mozGetUserMedia:return h.navigator.mozGetUserMedia(c,a,b);case typeof h.navigator.getUserMedia:return h.navigator.getUserMedia(c,a,b);default:throw Error("getUserMedia is not supported");}})).catch(function(a){throw h.util.isFirefox()&&"NotReadableError"===a.name?Error("Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.\nRelated Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"):a;})}},
{"../util":27}],14:[function(c,g,k){var a=c("./peerconnection");g.exports={enabled:function(c){"undefined"!==typeof c&&(a.enabled=c);return a.enabled},getMediaEngine:function(){return"undefined"!==typeof RTCIceGatherer?"ORTC":"WebRTC"},PeerConnection:a}},{"./peerconnection":18}],15:[function(c,g,k){function a(d){if(!(this instanceof a))return new a(d);var b=this;Object.defineProperties(this,{size:{enumerable:!0,get:function(){return b._map.size}},_map:{value:d}});$jscomp.initSymbol();$jscomp.initSymbolIterator();
$jscomp.initSymbol();$jscomp.initSymbolIterator();this[Symbol.iterator]=d[Symbol.iterator]}function l(a){return{type:"transport",id:a.id,timestamp:Date.parse(a.timestamp),bytesSent:void 0,bytesReceived:void 0,rtcpTransportStatsId:void 0,dtlsState:void 0,selectedCandidatePairId:a.stat("selectedCandidatePairId"),localCertificateId:a.stat("localCertificateId"),remoteCertificateId:a.stat("remoteCertificateId")}}function h(a){return{type:"codec",id:a.id,timestamp:Date.parse(a.timestamp),payloadType:void 0,
mimeType:a.stat("mediaType")+"/"+a.stat("googCodecName"),clockRate:void 0,channels:void 0,sdpFmtpLine:void 0,implementation:void 0}}function f(a){return{type:"track",id:a.id,timestamp:Date.parse(a.timestamp),trackIdentifier:a.stat("googTrackId"),remoteSource:void 0,ended:void 0,kind:a.stat("mediaType"),detached:void 0,ssrcIds:void 0,frameWidth:w(a,"googFrameWidthReceived")?r(a,"googFrameWidthReceived"):r(a,"googFrameWidthSent"),frameHeight:w(a,"googFrameHeightReceived")?r(a,"googFrameHeightReceived"):
r(a,"googFrameHeightSent"),framesPerSecond:void 0,framesSent:r(a,"framesEncoded"),framesReceived:void 0,framesDecoded:r(a,"framesDecoded"),framesDropped:void 0,framesCorrupted:void 0,partialFramesLost:void 0,fullFramesLost:void 0,audioLevel:w(a,"audioOutputLevel")?r(a,"audioOutputLevel")/32767:(r(a,"audioInputLevel")||0)/32767,echoReturnLoss:n(a,"googEchoCancellationReturnLoss"),echoReturnLossEnhancement:n(a,"googEchoCancellationReturnLossEnhancement")}}function b(a,d){return{id:a.id,timestamp:Date.parse(a.timestamp),
ssrc:a.stat("ssrc"),associateStatsId:void 0,isRemote:void 0,mediaType:a.stat("mediaType"),trackId:"track-"+a.id,transportId:a.stat("transportId"),codecId:"codec-"+a.id,firCount:d?r(a,"googFirsSent"):void 0,pliCount:d?r(a,"googPlisSent"):r(a,"googPlisReceived"),nackCount:d?r(a,"googNacksSent"):r(a,"googNacksReceived"),sliCount:void 0,qpSum:r(a,"qpSum")}}function e(a){var d=b(a,!0);Object.assign(d,{type:"inbound-rtp",packetsReceived:r(a,"packetsReceived"),bytesReceived:r(a,"bytesReceived"),packetsLost:r(a,
"packetsLost"),jitter:m(a.stat("googJitterReceived")),fractionLost:void 0,roundTripTime:m(a.stat("googRtt")),packetsDiscarded:void 0,packetsRepaired:void 0,burstPacketsLost:void 0,burstPacketsDiscarded:void 0,burstLossCount:void 0,burstDiscardCount:void 0,burstLossRate:void 0,burstDiscardRate:void 0,gapLossRate:void 0,gapDiscardRate:void 0,framesDecoded:r(a,"framesDecoded")});return d}function u(a){var d=b(a,!1);Object.assign(d,{type:"outbound-rtp",remoteTimestamp:void 0,packetsSent:r(a,"packetsSent"),
bytesSent:r(a,"bytesSent"),targetBitrate:void 0,framesEncoded:r(a,"framesEncoded")});return d}function p(a,d){var b=a.id,c=Date.parse(a.timestamp),e=a.stat("ipAddress"),m=r(a,"portNumber"),f=a.stat("transport"),p;a:switch(p=a.stat("candidateType"),p){case "peerreflexive":p="prflx";break a;case "serverreflexive":p="srflx"}return{type:d?"remote-candidate":"local-candidate",id:b,timestamp:c,transportId:void 0,isRemote:d,ip:e,port:m,protocol:f,candidateType:p,priority:n(a,"priority"),url:void 0,relayProtocol:void 0,
deleted:void 0}}function q(a){return{type:"candidate-pair",id:a.id,timestamp:Date.parse(a.timestamp),transportId:a.stat("googChannelId"),localCandidateId:a.stat("localCandidateId"),remoteCandidateId:a.stat("remoteCandidateId"),state:void 0,priority:void 0,nominated:void 0,writable:v(a,"googWritable"),readable:void 0,bytesSent:r(a,"bytesSent"),bytesReceived:r(a,"bytesReceived"),lastPacketSentTimestamp:void 0,lastPacketReceivedTimestamp:void 0,totalRoundTripTime:void 0,currentRoundTripTime:m(a.stat("googRtt")),
availableOutgoingBitrate:void 0,availableIncomingBitrate:void 0,requestsReceived:r(a,"requestsReceived"),requestsSent:r(a,"requestsSent"),responsesReceived:r(a,"responsesReceived"),responsesSent:r(a,"responsesSent"),retransmissionsReceived:void 0,retransmissionsSent:void 0,consentRequestsSent:r(a,"consentRequestsSent")}}function t(a){return{type:"certificate",id:a.id,timestamp:Date.parse(a.timestamp),fingerprint:a.stat("googFingerprint"),fingerprintAlgorithm:a.stat("googFingerprintAlgorithm"),base64Certificate:a.stat("googDerBase64"),
issuerCertificateId:a.stat("googIssuerId")}}function d(a){return{type:"data-channel",id:a.id,timestamp:Date.parse(a.timestamp),label:a.stat("label"),protocol:a.stat("protocol"),datachannelid:a.stat("datachannelid"),transportId:a.stat("transportId"),state:a.stat("state"),messagesSent:void 0,bytesSent:void 0,messagesReceived:void 0,bytesReceived:void 0}}function m(a){return isNaN(a)||""===a?void 0:parseInt(a,10)/1E3}function r(a,d){var b=a.stat(d);return w(a,d)?parseInt(b,10):void 0}function n(a,d){var b=
a.stat(d);return w(a,d)?parseFloat(b):void 0}function v(a,d){var b=a.stat(d);return w(a,d)?"true"===b||!0===b:void 0}function w(a,d){a=a.stat(d);return"undefined"!==typeof a&&""!==a}if(c="undefined"!==typeof window?window.RTCStatsReport:void 0)a.prototype=Object.create(c.prototype),a.prototype.constructor=a;"entries forEach get has keys values".split(" ").forEach(function(d){a.prototype[d]=function(){return this._map[d].apply(this._map,arguments)}});a.fromArray=function(d){return new a(d.reduce(function(a,
d){a.set(d.id,d);return a},new Map))};a.fromRTCStatsResponse=function(b){var c,m=new Map;b=b.result().reduce(function(a,b){var n=b.id;switch(b.type){case "googCertificate":a.set(n,t(b));break;case "datachannel":a.set(n,d(b));break;case "googCandidatePair":v(b,"googActiveConnection")&&(c=n);a.set(n,q(b));break;case "localcandidate":a.set(n,p(b,!1));break;case "remotecandidate":a.set(n,p(b,!0));break;case "ssrc":w(b,"packetsReceived")?a.set("rtp-"+n,e(b)):a.set("rtp-"+n,u(b));a.set("track-"+n,f(b));
a.set("codec-"+n,h(b));break;case "googComponent":var r=l(b);m.set(r.selectedCandidatePairId,n);a.set(n,l(b))}return a},new Map);if(c){var n=m.get(c);n&&(b.get(n).dtlsState="connected")}return new a(b)};g.exports=a},{}],16:[function(c,g,k){function a(b){if(!(this instanceof a))return new a(b);b=b||{};var c=Object.assign({},u,b.thresholds);Object.defineProperties(this,{_activeWarnings:{value:new Map},_currentStreaks:{value:new Map},_peerConnection:{value:b.peerConnection,writable:!0},_sampleBuffer:{value:[]},
_sampleInterval:{value:null,writable:!0},_thresholds:{value:c},_warningsEnabled:{value:!0,writable:!0}});b.peerConnection&&this.enable();f.call(this)}function l(a,b){return b.reduce(function(b,d){return b+(d<a?1:0)},0)}function h(a,b){return b.reduce(function(b,d){return b+(d>a?1:0)},0)}var f=c("events").EventEmitter,b=c("./stats");k=c("util").inherits;var e=c("./mos"),u={audioInputLevel:{maxDuration:10},audioOutputLevel:{maxDuration:10},packetsLostFraction:{max:1},jitter:{max:30},rtt:{max:400},mos:{min:3}};
k(a,f);a.createSample=function(a,b){var c=a.packetsReceived-(b&&b.totals.packetsReceived||0),d=a.packetsLost-(b&&b.totals.packetsLost||0),m=c+d,m=0<m?d/m*100:0,f=a.packetsReceived+a.packetsLost;return{timestamp:a.timestamp,totals:{packetsReceived:a.packetsReceived,packetsLost:a.packetsLost,packetsSent:a.packetsSent,packetsLostFraction:0<f?a.packetsLost/f*100:100,bytesReceived:a.bytesReceived,bytesSent:a.bytesSent},packetsSent:a.packetsSent-(b&&b.totals.packetsSent||0),packetsReceived:c,packetsLost:d,
packetsLostFraction:m,audioInputLevel:a.audioInputLevel,audioOutputLevel:a.audioOutputLevel,jitter:a.jitter,rtt:a.rtt,mos:e.calculate(a,b&&m)}};a.prototype.enable=function(a){if(a){if(this._peerConnection&&a!==this._peerConnection)throw Error("Attempted to replace an existing PeerConnection in RTCMonitor.enable");this._peerConnection=a}if(!this._peerConnection)throw Error("Can not enable RTCMonitor without a PeerConnection");this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),
1E3);return this};a.prototype.disable=function(){clearInterval(this._sampleInterval);this._sampleInterval=null;return this};a.prototype.getSample=function(){var c=this;return b(this._peerConnection).then(function(b){return a.createSample(b,c._sampleBuffer.length&&c._sampleBuffer[c._sampleBuffer.length-1])})};a.prototype._fetchSample=function(){var a=this;return this.getSample().then(function(b){a._addSample(b);a._raiseWarnings();a.emit("sample",b);return b},function(b){a.disable();a.emit("error",
b)})};a.prototype._addSample=function(a){var b=this._sampleBuffer;b.push(a);5<b.length&&b.splice(0,b.length-5)};a.prototype._raiseWarnings=function(){if(this._warningsEnabled)for(var a in this._thresholds)this._raiseWarningsForStat(a)};a.prototype.enableWarnings=function(){this._warningsEnabled=!0;return this};a.prototype.disableWarnings=function(){this._warningsEnabled&&this._activeWarnings.clear();this._warningsEnabled=!1;return this};a.prototype._raiseWarningsForStat=function(a){var b=this._sampleBuffer,
c=this._thresholds[a],d=b.slice(-5),d=d.map(function(d){return d[a]});if(!d.some(function(a){return"undefined"===typeof a||null===a})){var e;"number"===typeof c.max&&(e=h(c.max,d),3<=e?this._raiseWarning(a,"max",{values:d}):0>=e&&this._clearWarning(a,"max",{values:d}));"number"===typeof c.min&&(e=l(c.min,d),3<=e?this._raiseWarning(a,"min",{values:d}):0>=e&&this._clearWarning(a,"min",{values:d}));"number"===typeof c.maxDuration&&1<b.length&&(d=b.slice(-2),b=d[0][a],e=d[1][a],d=this._currentStreaks.get(a)||
0,b=b===e?d+1:0,this._currentStreaks.set(a,b),b>=c.maxDuration?this._raiseWarning(a,"maxDuration",{value:b}):0===b&&this._clearWarning(a,"maxDuration",{value:d}))}};a.prototype._clearWarning=function(a,b,c){var d=a+":"+b,e=this._activeWarnings.get(d);!e||5E3>Date.now()-e.timeRaised||(this._activeWarnings.delete(d),this.emit("warning-cleared",Object.assign({name:a,threshold:{name:b,value:this._thresholds[a][b]}},c)))};a.prototype._raiseWarning=function(a,b,c){var d=a+":"+b;this._activeWarnings.has(d)||
(this._activeWarnings.set(d,{timeRaised:Date.now()}),this.emit("warning",Object.assign({name:a,threshold:{name:b,value:this._thresholds[a][b]}},c)))};g.exports=a},{"./mos":17,"./stats":20,events:34,util:49}],17:[function(c,g,k){function a(a){return"number"===typeof a&&!isNaN(a)&&isFinite(a)&&0<=a}g.exports={calculate:function(c,h){if(!(c&&a(c.rtt)&&a(c.jitter)&&a(h)))return null;var f=c.rtt+2*c.jitter+10;c=0;switch(!0){case 160>f:c=94.768-f/40;break;case 1E3>f:c=94.768-(f-120)/10;break;case 1E3<=
f:c=94.768-f/100}f=.01;switch(!0){case -1===h:c=f=0;break;case h<=c/2.5:f=2.5;break;case h>c/2.5&&100>h:f=.25}h=c-h*f;h=1+.035*h+7E-6*h*(h-60)*(100-h);return 1<=h&&4.6>h?h:null}}},{}],18:[function(c,g,k){function a(d,b,c){function n(){}if(!d||!b)throw Error("Device and getUserMedia are required arguments");if(!(this instanceof a))return new a(d,b,c);this.onvolume=this.onicecandidate=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onreconnect=this.ondisconnect=this.onclose=this.onerror=
this.onopen=n;this.version=null;this.pstream=d.stream;this.stream=null;this.sinkIds=new Set(["default"]);this.outputs=new Map;this.status="connecting";this.callSid=null;this.isMuted=!1;this.getUserMedia=b;b="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);this._isSinkSupported=!!b&&"undefined"!==typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId;this._audioContext=b&&d.audio._audioContext;this._dtmfSender=this._mediaStreamSource=this._masterAudioDeviceId=this._masterAudio=
null;this._dtmfSenderUnsupported=!1;this._callEvents=[];this._nextTimeToPublish=Date.now();this._onAnswerOrRinging=n;this._remoteStream=null;this._shouldManageStream=this._shouldStopTracks=!0;e.mixinLog(this,"[Twilio.PeerConnection]");this.log.enabled=d.options.debug;this.log.warnings=d.options.warnings;this._iceConnectionStateMachine=new u(q,"new");this._signalingStateMachine=new u(t,"stable");this.options=c=c||{};this.navigator=c.navigator||("undefined"!==typeof navigator?navigator:null);this.util=
c.util||p;return this}function l(a,b){"function"===typeof a.addTrack?b.getAudioTracks().forEach(function(d){a.addTrack(d,b)}):a.addStream(b)}function h(a){var d="undefined"!==typeof MediaStream?new MediaStream:new webkitMediaStream;a.getAudioTracks().forEach(d.addTrack,d);return d}function f(a,b){"function"===typeof a.removeTrack?a.getSenders().forEach(function(d){a.removeTrack(d)}):a.removeStream(b)}function b(a,b){if("undefined"!==typeof a.srcObject)a.srcObject=b;else if("undefined"!==typeof a.mozSrcObject)a.mozSrcObject=
b;else if("undefined"!==typeof a.src){var d=a.options.window||window;a.src=(d.URL||d.webkitURL).createObjectURL(b)}else return!1;return!0}var e=c("../log"),u=c("../statemachine"),p=c("../util");c=c("./rtcpc");var q={new:["checking","closed"],checking:["new","connected","failed","closed","completed"],connected:["new","disconnected","completed","closed"],completed:["new","disconnected","closed","completed"],failed:["new","disconnected","closed"],disconnected:["connected","completed","failed","closed"],
closed:[]},t={stable:["have-local-offer","have-remote-offer","closed"],"have-local-offer":["stable","closed"],"have-remote-offer":["stable","closed"],closed:[]};a.prototype.uri=function(){return this._uri};a.prototype.openWithConstraints=function(a){return this.getUserMedia({audio:a}).then(this._setInputTracksFromStream.bind(this,!1))};a.prototype.openWithStream=function(a){var d=this;return this._setInputTracksFromStream(!0,a).then(function(){d._shouldManageStream=!1})};a.prototype.setInputTracksFromStream=
function(a){var d=this;return this._setInputTracksFromStream(!0,a).then(function(){d._shouldStopTracks=!1;d._shouldManageStream=!1})};a.prototype._createAnalyser=function(a,b){var d=b.createAnalyser();d.fftSize=32;d.smoothingTimeConstant=.3;b.createMediaStreamSource(a).connect(d);return d};a.prototype._setVolumeHandler=function(a){this.onvolume=a};a.prototype._startPollingVolume=function(){if(this._audioContext&&this.stream&&this._remoteStream){var a=this._audioContext,b=(this._inputAnalyser=this._createAnalyser(this.stream,
a)).frequencyBinCount,c=new Uint8Array(b),a=(this._outputAnalyser=this._createAnalyser(this._remoteStream,a)).frequencyBinCount,e=new Uint8Array(a),f=this;requestAnimationFrame(function B(){if(f._audioContext)if("closed"===f.status)f._inputAnalyser.disconnect(),f._outputAnalyser.disconnect();else{f._inputAnalyser.getByteFrequencyData(c);var a=f.util.average(c);f._outputAnalyser.getByteFrequencyData(e);var d=f.util.average(e);f.onvolume(a/255,d/255);requestAnimationFrame(B)}})}};a.prototype._stopStream=
function(a){this._shouldStopTracks&&("function"===typeof MediaStreamTrack.prototype.stop?("function"===typeof a.getAudioTracks?a.getAudioTracks():a.audioTracks).forEach(function(a){a.stop()}):a.stop())};a.prototype._setInputTracksFromStream=function(a,b){var d=this;if(!b)return Promise.reject(Error("Can not set input stream to null while in a call"));if(!b.getAudioTracks().length)return Promise.reject(Error("Supplied input stream has no audio tracks"));var c=this.stream;c?(this._stopStream(c),f(this.version.pc,
c),c.getAudioTracks().forEach(c.removeTrack,c),b.getAudioTracks().forEach(c.addTrack,c),l(this.version.pc,b)):this.stream=a?h(b):b;this.mute(this.isMuted);return this.version?new Promise(function(a,b){d.version.createOffer({audio:!0},function(){d.version.processAnswer(d._answerSdp,function(){d._audioContext&&(d._inputAnalyser=d._createAnalyser(d.stream,d._audioContext));a(d.stream)},b)},b)}):Promise.resolve(this.stream)};a.prototype._onInputDevicesChanged=function(){this.stream&&this.stream.getAudioTracks().every(function(a){return"ended"===
a.readyState})&&this._shouldManageStream&&this.openWithConstraints(!0)};a.prototype._setSinkIds=function(a){if(!this._isSinkSupported)return Promise.reject(Error("Audio output selection is not supported by this browser"));this.sinkIds=new Set(a.forEach?a:[a]);return this.version?this._updateAudioOutputs():Promise.resolve()};a.prototype._updateAudioOutputs=function(){var a=Array.from(this.sinkIds).filter(function(a){return!this.outputs.has(a)},this),b=Array.from(this.outputs.keys()).filter(function(a){return!this.sinkIds.has(a)},
this),c=this,a=a.map(this._createAudioOutput,this);return Promise.all(a).then(function(){return Promise.all(b.map(c._removeAudioOutput,c))})};a.prototype._createAudio=function(a){return new Audio(a)};a.prototype._createAudioOutput=function(a){var d=this._audioContext.createMediaStreamDestination();this._mediaStreamSource.connect(d);var c=this._createAudio();b(c,d.stream);var e=this;return c.setSinkId(a).then(function(){return c.play()}).then(function(){e.outputs.set(a,{audio:c,dest:d})})};a.prototype._removeAudioOutputs=
function(){return Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)};a.prototype._disableOutput=function(a,b){if(a=a.outputs.get(b))a.audio&&(a.audio.pause(),a.audio.src=""),a.dest&&a.dest.disconnect()};a.prototype._reassignMasterOutput=function(a,b){var d=a.outputs.get(b);a.outputs.delete(b);var c=this,e=Array.from(a.outputs.keys())[0]||"default";return d.audio.setSinkId(e).then(function(){c._disableOutput(a,e);a.outputs.set(e,d);a._masterAudioDeviceId=e}).catch(function(c){a.outputs.set(b,
d);throw c;})};a.prototype._removeAudioOutput=function(a){if(this._masterAudioDeviceId===a)return this._reassignMasterOutput(this,a);this._disableOutput(this,a);this.outputs.delete(a);return Promise.resolve()};a.prototype._onAddTrack=function(a,c){var d=a._masterAudio=this._createAudio();b(d,c);d.play();var e=Array.from(a.outputs.keys())[0]||"default";a._masterAudioDeviceId=e;a.outputs.set(e,{audio:d});a._mediaStreamSource=a._audioContext.createMediaStreamSource(c);a.pcStream=c;a._updateAudioOutputs()};
a.prototype._fallbackOnAddTrack=function(a,c){var d=document&&document.createElement("audio");d.autoplay=!0;b(d,c)||a.log("Error attaching stream to element.");a.outputs.set("default",{audio:d})};a.prototype._setupPeerConnection=function(a,b){var d=this,c=this._getProtocol();c.create(this.log,a,b);l(c.pc,this.stream);c.pc["ontrack"in c.pc?"ontrack":"onaddstream"]=function(a){a=d._remoteStream=a.stream||a.streams[0];d._isSinkSupported?d._onAddTrack(d,a):d._fallbackOnAddTrack(d,a);d._startPollingVolume()};
return c};a.prototype._setupChannel=function(){var a=this,b=this.version.pc;a.version.pc.onopen=function(){a.status="open";a.onopen()};a.version.pc.onstatechange=function(){a.version.pc&&"stable"===a.version.pc.readyState&&(a.status="open",a.onopen())};a.version.pc.onsignalingstatechange=function(){var d=b.signalingState;a.log('signalingState is "'+d+'"');try{a._signalingStateMachine.transition(d)}catch(n){a.log("Failed to transition to signaling state "+d+": "+n)}a.version.pc&&"stable"===a.version.pc.signalingState&&
(a.status="open",a.onopen());a.onsignalingstatechange(b.signalingState)};b.onicecandidate=function(b){a.onicecandidate(b.candidate)};b.oniceconnectionstatechange=function(){var d=b.iceConnectionState,c=a._iceConnectionStateMachine.currentState;try{a._iceConnectionStateMachine.transition(d)}catch(v){a.log("Failed to transition to ice connection state "+d+": "+v)}switch(d){case "connected":"disconnected"===c&&(c="ICE liveliness check succeeded. Connection with Twilio restored",a.log(c),a.onreconnect(c));
break;case "disconnected":c="ICE liveliness check failed. May be having trouble connecting to Twilio";a.log(c);a.ondisconnect(c);break;case "failed":c=("checking"===c?"ICE negotiation with Twilio failed.":"Connection with Twilio was interrupted.")+" Call will terminate.";a.log(c);a.onerror({info:{code:31003,message:c},disconnect:!0});break;default:a.log('iceConnectionState is "'+d+'"')}a.oniceconnectionstatechange(d)}};a.prototype._initializeMediaStream=function(a,b){if("open"===this.status)return!1;
if("disconnected"===this.pstream.status)return this.onerror({info:{code:31E3,message:"Cannot establish connection. Client is disconnected"}}),this.close(),!1;this.version=this._setupPeerConnection(a,b);this._setupChannel();return!0};a.prototype.makeOutgoingCall=function(a,b,c,e,f,h){function d(){h(m.version.pc)}function n(a){m.onerror({info:{code:31E3,message:"Error processing answer: "+(a.message||a)}})}if(this._initializeMediaStream(e,f)){var m=this;this.callSid=c;this._onAnswerOrRinging=function(a){a.sdp&&
(m._answerSdp=a.sdp,"closed"!==m.status&&m.version.processAnswer(a.sdp,d,n),m.pstream.removeListener("answer",m._onAnswerOrRinging),m.pstream.removeListener("ringing",m._onAnswerOrRinging))};this.pstream.on("answer",this._onAnswerOrRinging);this.pstream.on("ringing",this._onAnswerOrRinging);this.version.createOffer({audio:!0},function(){"closed"!==m.status&&m.pstream.publish("invite",{sdp:m.version.getSDP(),callsid:m.callSid,twilio:{accountsid:a?m.util.objectize(a).iss:null,params:b}})},function(a){m.onerror({info:{code:31E3,
message:"Error creating the offer: "+(a.message||a)}})})}};a.prototype.answerIncomingCall=function(a,b,c,e,f){if(this._initializeMediaStream(c,e)){this._answerSdp=b.replace(/^a=setup:actpass$/gm,"a=setup:passive");this.callSid=a;var d=this;this.version.processSDP(b,{audio:!0},function(){"closed"!==d.status&&(d.pstream.publish("answer",{callsid:a,sdp:d.version.getSDP()}),f(d.version.pc))},function(a){d.onerror({info:{code:31E3,message:"Error creating the answer: "+(a.message||a)}})})}};a.prototype.close=
function(){this.version&&this.version.pc&&("closed"!==this.version.pc.signalingState&&this.version.pc.close(),this.version.pc=null);this.stream&&(this.mute(!1),this._stopStream(this.stream));this.stream=null;this.pstream&&this.pstream.removeListener("answer",this._onAnswerOrRinging);this._removeAudioOutputs();this._mediaStreamSource&&this._mediaStreamSource.disconnect();this._inputAnalyser&&this._inputAnalyser.disconnect();this._outputAnalyser&&this._outputAnalyser.disconnect();this.status="closed";
this.onclose()};a.prototype.reject=function(a){this.callSid=a};a.prototype.ignore=function(a){this.callSid=a};a.prototype.mute=function(a){this.isMuted=a;this.stream&&("function"===typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks).forEach(function(b){b.enabled=!a})};a.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var a=this,b=this.version.pc;if(!b)return this.log("No RTCPeerConnection available to call createDTMFSender on"),
null;if("function"===typeof b.getSenders&&("function"===typeof RTCDTMFSender||"function"===typeof RTCDtmfSender)){var c=b.getSenders().find(function(a){return a.dtmf});if(c&&c.dtmf)return this.log("Using RTCRtpSender#dtmf"),this._dtmfSender=c.dtmf}if("function"===typeof b.createDTMFSender&&"function"===typeof b.getLocalStreams){c=b.getLocalStreams().map(function(b){return(b=a._getAudioTracks(b))&&b[0]})[0];if(!c)return this.log("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),
null;this.log("Creating RTCDTMFSender");return this._dtmfSender=b.createDTMFSender(c)}this.log("RTCPeerConnection does not support RTCDTMFSender");this._dtmfSenderUnsupported=!0;return null};a.prototype._canStopMediaStreamTrack=function(){return"function"===typeof MediaStreamTrack.prototype.stop};a.prototype._getAudioTracks=function(a){return"function"===typeof a.getAudioTracks?a.getAudioTracks():a.audioTracks};a.prototype._getProtocol=function(){return a.protocol};a.protocol=c.test()?new c:null;
a.enabled=!!a.protocol;g.exports=a},{"../log":8,"../statemachine":25,"../util":27,"./rtcpc":19}],19:[function(c,g,k){function a(){"undefined"===typeof window?this.log("No RTCPeerConnection implementation available. The window object was not found."):f.isEdge()?(this.RTCPeerConnection=h.RTCPeerConnection,window.RTCSessionDescription=h.RTCSessionDescription,window.RTCIceCandidate=h.RTCIceCandidate):"function"===typeof window.RTCPeerConnection?this.RTCPeerConnection=window.RTCPeerConnection:"function"===
typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=webkitRTCPeerConnection:"function"===typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log("No RTCPeerConnection implementation available")}function l(a,c,f){return function(){var b=Array.prototype.slice.call(arguments);return(new Promise(function(e){e(a.apply(c,b))})).catch(function(){return new Promise(function(e,
h){a.apply(c,f?[e,h].concat(b):b.concat([e,h]))})})}}var h=c("ortc-adapter"),f=c("../util");a.prototype.create=function(a,c,f){this.log=a;this.pc=new this.RTCPeerConnection({iceServers:f},c)};a.prototype.createModernConstraints=function(a){if("undefined"===typeof a)return null;var b={};"undefined"!==typeof webkitRTCPeerConnection?(b.mandatory={},"undefined"!==typeof a.audio&&(b.mandatory.OfferToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.mandatory.OfferToReceiveVideo=a.video)):("undefined"!==
typeof a.audio&&(b.offerToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.offerToReceiveVideo=a.video));return b};a.prototype.createOffer=function(a,c,f){var b=this;a=this.createModernConstraints(a);l(this.pc.createOffer,this.pc,!0)(a).then(function(a){return b.pc&&l(b.pc.setLocalDescription,b.pc,!1)(new RTCSessionDescription(a))}).then(c,f)};a.prototype.createAnswer=function(a,c,f){var b=this;a=this.createModernConstraints(a);l(this.pc.createAnswer,this.pc,!0)(a).then(function(a){return b.pc&&
l(b.pc.setLocalDescription,b.pc,!1)(new RTCSessionDescription(a))}).then(c,f)};a.prototype.processSDP=function(a,c,f,h){var b=this;a=new RTCSessionDescription({sdp:a,type:"offer"});l(this.pc.setRemoteDescription,this.pc,!1)(a).then(function(){b.createAnswer(c,f,h)})};a.prototype.getSDP=function(){return this.pc.localDescription.sdp};a.prototype.processAnswer=function(a,c,f){this.pc&&l(this.pc.setRemoteDescription,this.pc,!1)(new RTCSessionDescription({sdp:a,type:"answer"})).then(c,f)};a.test=function(){if("object"===
typeof navigator){var a=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(a&&"function"===typeof window.RTCPeerConnection||a&&"function"===typeof window.webkitRTCPeerConnection)return!0;if(a&&"function"===typeof window.mozRTCPeerConnection){try{if("function"!==typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(e){return!1}return!0}if("undefined"!==typeof RTCIceGatherer)return!0}return!1};
g.exports=a},{"../util":27,"ortc-adapter":35}],20:[function(c,g,k){function a(){}function l(b){var c=null,e=new a;Array.from(b.values()).forEach(function(a){switch(a.type.replace("-","")){case "inboundrtp":e.timestamp=a.timestamp;e.jitter=1E3*a.jitter;e.packetsLost=a.packetsLost;e.packetsReceived=a.packetsReceived;e.bytesReceived=a.bytesReceived;if(a=b.get(a.trackId))e.audioOutputLevel=32767*a.audioLevel;break;case "outboundrtp":e.packetsSent=a.packetsSent;e.bytesSent=a.bytesSent;if(a.codecId&&b.get(a.codecId)){var d=
b.get(a.codecId).mimeType;e.codecName=d&&d.match(/(.*\/)?(.*)/)[2]}if(a=b.get(a.trackId))e.audioInputLevel=32767*a.audioLevel;break;case "transport":"connected"===a.dtlsState&&(c=a.id)}});var f=b.get(c);if(!f)return e;f=b.get(f.selectedCandidatePairId);if(!f)return e;var h=b.get(f.localCandidateId),d=b.get(f.remoteCandidateId);Object.assign(e,{localAddress:h&&h.ip,remoteAddress:d&&d.ip,rtt:f&&1E3*f.currentRoundTripTime});return e}var h=c("./mockrtcstatsreport"),f=!1;if("undefined"!==typeof window){c=
!!window.navigator.userAgent.match("CriOS");k=!!window.navigator.userAgent.match("Electron");var b="undefined"!==typeof window.chrome&&"Google Inc."===window.navigator.vendor&&-1===window.navigator.userAgent.indexOf("OPR")&&-1===window.navigator.userAgent.indexOf("Edge"),f=c||k||b}g.exports=function(a,b){b=Object.assign({createRTCSample:l},b);if(!a)return Promise.reject(Error("PeerConnection is null"));if("function"!==typeof a.getStats)return Promise.reject(Error("WebRTC statistics are unsupported"));
if(f)return(new Promise(function(b,c){return a.getStats(b,c)})).then(h.fromRTCStatsResponse).then(b.createRTCSample);var c;try{c=a.getStats()}catch(q){c=(new Promise(function(b,d){return a.getStats(b,d)})).then(h.fromRTCStatsResponse)}return c.then(b.createRTCSample)}},{"./mockrtcstatsreport":15}],21:[function(c,g,k){function a(){Object.defineProperties(this,{_eventEmitter:{value:new l},_handlers:{value:{}}})}var l=c("events").EventEmitter;a.prototype.dispatchEvent=function(a){return this._eventEmitter.emit(a.type,
a)};a.prototype.addEventListener=function(){return this._eventEmitter.addListener.apply(this._eventEmitter,arguments)};a.prototype.removeEventListener=function(){return this._eventEmitter.removeListener.apply(this._eventEmitter,arguments)};a.prototype._defineEventHandler=function(a){var c=this;Object.defineProperty(this,"on"+a,{get:function(){return c._handlers[a]},set:function(b){var e=c._handlers[a];!e||"function"!==typeof b&&"undefined"!==typeof b&&null!==b||(c._handlers[a]=null,c.removeEventListener(a,
e));"function"===typeof b&&(c._handlers[a]=b,c.addEventListener(a,b))}})};g.exports=a},{events:34}],22:[function(c,g,k){g.exports=function(a){Object.defineProperties(this,{deviceId:{get:function(){return a.deviceId}},groupId:{get:function(){return a.groupId}},kind:{get:function(){return a.kind}},label:{get:function(){return a.label}}})}},{}],23:[function(c,g,k){function a(){p.call(this);this._defineEventHandler("devicechange");this._defineEventHandler("deviceinfochange");var a=[];Object.defineProperties(this,
{_deviceChangeIsNative:{value:e(this,"devicechange")},_deviceInfoChangeIsNative:{value:e(this,"deviceinfochange")},_knownDevices:{value:a},_pollInterval:{value:null,writable:!0}});"function"===typeof q.enumerateDevices&&q.enumerateDevices().then(function(b){b.sort(u).forEach([].push,a)});this._eventEmitter.on("newListener",function(a){if("devicechange"===a||"deviceinfochange"===a)this._pollInterval=this._pollInterval||setInterval(f.bind(null,this),500)}.bind(this));this._eventEmitter.on("removeListener",
function(){this._pollInterval&&!h(this)&&(clearInterval(this._pollInterval),this._pollInterval=null)}.bind(this))}function l(a,b){var d=b.reduce(function(a,b){return a.set(b.deviceId,b.label||null)},new Map);return a.some(function(a){var b=d.get(a.deviceId);return"undefined"!==typeof b&&b!==a.label})}function h(a){return 0<["devicechange","deviceinfochange"].reduce(function(b,c){return b+a._eventEmitter.listenerCount(c)},0)}function f(a){q.enumerateDevices().then(function(d){var c=a._knownDevices,
e=c.slice();[].splice.apply(c,[0,c.length].concat(d.sort(u)));a._deviceChangeIsNative||c.length===e.length&&!b("deviceId",c,e)||a.dispatchEvent(new Event("devicechange"));!a._deviceInfoChangeIsNative&&l(c,e)&&a.dispatchEvent(new Event("deviceinfochange"))})}function b(a,b,c){return b.some(function(b,d){return b[a]!==c[d][a]})}function e(a,b){function d(b){a.dispatchEvent(b)}var c="on"+b;return c in q?("addEventListener"in q?q.addEventListener(b,d):q[c]=d,!0):!1}function u(a,b){return a.deviceId<b.deviceId}
var p=c("./eventtarget");c=c("util").inherits;var q="undefined"!==typeof navigator&&navigator.mediaDevices;c(a,p);q&&"function"===typeof q.enumerateDevices&&(a.prototype.enumerateDevices=function(){return q.enumerateDevices.apply(q,arguments)});a.prototype.getUserMedia=function(){return q.getUserMedia.apply(q,arguments)};g.exports=q?new a:null},{"./eventtarget":21,util:49}],24:[function(c,g,k){function a(c,b,e){if(!(this instanceof a))return new a(c,b,e);if(!c||!b)throw Error("name and url are required arguments");
e=Object.assign({AudioFactory:"undefined"!==typeof Audio?Audio:null,maxDuration:0,shouldLoop:!1},e);e.AudioPlayer=e.audioContext?h.bind(h,e.audioContext):e.AudioFactory;Object.defineProperties(this,{_activeEls:{value:new Set},_Audio:{value:e.AudioPlayer},_isSinkSupported:{value:null!==e.AudioFactory&&"function"===typeof e.AudioFactory.prototype.setSinkId},_maxDuration:{value:e.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_playPromise:{value:null,writable:!0},_shouldLoop:{value:e.shouldLoop},
_sinkIds:{value:["default"]},isPlaying:{enumerable:!0,get:function(){return!!this._playPromise}},name:{enumerable:!0,value:c},url:{enumerable:!0,value:b}});this._Audio&&l(this._Audio,b)}function l(a,b){a=new a(b);a.preload="auto";a.muted=!0;a.play()}var h=c("AudioPlayer");a.prototype.setSinkIds=function(a){this._isSinkSupported&&(a=a.forEach?a:[a],[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(a)))};a.prototype.stop=function(){this._activeEls.forEach(function(a){a.pause();a.src="";
a.load()});this._activeEls.clear();clearTimeout(this._maxDurationTimeout);this._maxDurationTimeout=this._playPromise=null};a.prototype.play=function(){this.isPlaying&&this.stop();0<this._maxDuration&&(this._maxDurationTimeout=setTimeout(this.stop.bind(this),this._maxDuration));var a=this,b=this._playPromise=Promise.all(this._sinkIds.map(function(c){if(!a._Audio)return Promise.resolve();var e=new a._Audio(a.url);e.loop=a._shouldLoop;e.addEventListener("ended",function(){a._activeEls.delete(e)});return(new Promise(function(a){e.addEventListener("canplaythrough",
a)})).then(function(){return a.isPlaying&&a._playPromise===b?(a._isSinkSupported?e.setSinkId(c):Promise.resolve()).then(function(){a._activeEls.add(e);return e.play()}).then(function(){return e},function(b){a._activeEls.delete(e);throw b;}):Promise.resolve()})}));return b};g.exports=a},{AudioPlayer:33}],25:[function(c,g,k){function a(c,b){if(!(this instanceof a))return new a(c,b);var e=b;Object.defineProperties(this,{_currentState:{get:function(){return e},set:function(a){e=a}},currentState:{enumerable:!0,
get:function(){return e}},states:{enumerable:!0,value:c},transitions:{enumerable:!0,value:[]}});Object.freeze(this)}function l(a,b){Object.defineProperties(this,{from:{enumerable:!0,value:a},to:{enumerable:!0,value:b}})}function h(a,b){if(!(this instanceof h))return new h(a,b);Error.call(this);l.call(this,a,b);Object.defineProperties(this,{message:{enumerable:!0,value:"Invalid transition from "+("string"===typeof a?'"'+a+'"':"null")+' to "'+b+'"'}});Object.freeze(this)}c=c("util").inherits;a.prototype.transition=
function(a){var b=this.currentState,c=this.states[b],b=c&&-1!==c.indexOf(a)?new l(b,a):new h(b,a);this.transitions.push(b);this._currentState=a;if(b instanceof h)throw b;return this};c(h,Error);g.exports=a},{util:49}],26:[function(c,g,k){k.SOUNDS_DEPRECATION_WARNING="Device.sounds is deprecated and will be removed in the next breaking release. Please use the new functionality available on Device.audio.";k.generateEventWarning=function(a,c,h){return"The number of "+a+" listeners on "+c+" exceeds the recommended number of "+
h+". While twilio.js will continue to function normally, this may be indicative of an application error. Note that "+a+" listeners exist for the lifetime of the "+c+"."}},{}],27:[function(c,g,k){function a(b){if(!(this instanceof a))return new a(b);this.message=b}function l(a){return function(){var b=Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};a.memo[b]||(a.memo[b]=a.apply(null,b));return a.memo[b]}}function h(b){b=b.split(".");if(3!==b.length)throw new a("Wrong number of segments");
return m(b[1])}function f(a){if(""===a)return{};if(-1===a.indexOf("&")&&-1===a.indexOf("="))return a;a=a.split("&");for(var b={},d=0;d<a.length;d++){var c=a[d].split("=");b[decodeURIComponent(c[0])]=f(decodeURIComponent(c[1]))}return b}function b(a){try{return btoa(a)}catch(v){return(new Buffer(a)).toString("base64")}}function e(a){try{return atob(a)}catch(v){try{return(new Buffer(a,"base64")).toString("ascii")}catch(w){return base64.decode(a)}}}function u(a,b){return a===b?!0:typeof a!==typeof b?
!1:a instanceof Date&&b instanceof Date?a.getTime()===b.getTime():"object"!==typeof a&&"object"!==typeof b?a===b:p(a,b)}function p(a,b){if("undefined"===typeof a||null===a||"undefined"===typeof b||null===b||a.prototype!==b.prototype)return!1;try{var d=r(a),c=r(b)}catch(G){return!1}if(d.length!==c.length)return!1;d.sort();c.sort();for(c=d.length-1;0<=c;c--){var e=d[c];if(!u(a[e],b[e]))return!1}return!0}function q(a){var b=[],d;for(d in a){var c="object"===typeof a[d]?q(a[d]):a[d];b.push(encodeURIComponent(d)+
"="+encodeURIComponent(c))}}var t=c("events").EventEmitter,d=c("./strings").generateEventWarning;a.prototype.toString=function(){return"Twilio.Exception: "+this.message};var m=l(function(a){var b=a.length%4;0<b&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a=e(a);return JSON.parse(a)});c=l(function(b){b=h(b);for(var d=0===b.scope.length?[]:b.scope.split(" "),c={},e=0;e<d.length;e++){var m;m=d[e].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!m||4!==m.length)throw new a("Bad scope URI");
m={service:m[1],privilege:m[2],params:f(m[3])};c[m.service+":"+m.privilege]=m}b.scope=c;return b});var r="function"===typeof Object.keys?Object.keys:function(a){var b=[],d;for(d in a)b.push(d);return b};k.getPStreamVersion=function(){return"1.4"};k.getReleaseVersion=function(){return"1.4.26"};k.getSoundVersion=function(){return"1.0.0"};k.dummyToken=function(a){var d={iss:"AC1111111111111111111111111111111",exp:14E8},c;for(c in d)a[c]=a[c]||d[c];a=b(JSON.stringify(a));a=a.replace(/=/g,"").replace(/\+/g,
"-").replace(/\//g,"_");return["*",a,"*"].join(".")};k.Exception=a;k.decode=h;k.btoa=b;k.atob=e;k.objectize=c;k.urlencode=function(a,b){var d=[],c;b=b||!1;for(var e in a)if(b&&a[e]instanceof Array)for(var f in a[e])c=a[e][f],d.push(encodeURIComponent(e)+"="+encodeURIComponent(c));else c=a[e],d.push(encodeURIComponent(e)+"="+encodeURIComponent(c));return d.join("&")};k.encodescope=function(a,b,d){a=["scope",a,b].join(":");b=!0;for(var c in d){void 0;b=!1;break}return b?a:a+"?"+q(d)};k.Set=Set;k.bind=
function(a,b){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return a.apply(b,d.concat(c))}};k.getSystemInfo=function(){var a="undefined"!==typeof navigator?navigator:{};return{p:"browser",v:"1.4",h:"aaa1c1d",browser:{userAgent:a.userAgent||"unknown",platform:a.platform||"unknown"},plugin:"rtc"}};k.splitObjects=function(a){a="string"!==typeof a?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");return 0===a.length?[]:a.split("\n")};k.generateConnectionUUID=
function(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)})};k.getTwilioRoot=function(){return"https://media.twiliocdn.com/sdk/js/client/"};k.monitorEventEmitter=function(a,b){function c(e){var f=t.listenerCount(b,e);e=d(e,a,10);10<=f&&("undefined"!==typeof console&&(console.warn?console.warn(e):console.log&&console.log(e)),b.removeListener("newListener",c))}b.setMaxListeners(0);b.on("newListener",c)};k.deepEqual=
u;k.average=function(a){return a.reduce(function(a,b){return a+b})/a.length};k.difference=function(a,b,d){d=d||function(a){return a};var c=new Set(b.map(d));return a.filter(function(a){return!c.has(d(a))})};k.isFirefox=function(a){return(a=a||("undefined"===typeof window?global.navigator:window.navigator))&&"string"===typeof a.userAgent&&/firefox|fxios/i.test(a.userAgent)};k.isEdge=function(a){return(a=a||("undefined"===typeof window?global.navigator:window.navigator))&&"string"===typeof a.userAgent&&
/edge\/\d+/i.test(a.userAgent)}},{"./strings":26,events:34}],28:[function(c,g,k){function a(){}function l(c){if(!(this instanceof l))return new l(c);this.sock=null;this.onerror=this.onmessage=this.onclose=this.onopen=a;var e={logPrefix:"[WSTransport]",chunderw:"chunderw-vpc-gll.twilio.com",reconnect:!0,debug:!1,secureSignaling:!0,WebSocket:b};c=c||{};for(var h in e)h in c||(c[h]=e[h]);this.options=c;this._WebSocket=c.WebSocket;f.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;
this.defaultReconnect=this.options.reconnect;this.uri=(this.options.secureSignaling?"wss://":"ws://")+this.options.host+"/signal";return this}var h=c("./heartbeat").Heartbeat,f=c("./log"),b=c("ws");l.prototype.msgQueue=[];l.prototype.open=function(a){this.log("Opening socket");this.sock&&2>this.sock.readyState?this.log("Socket already open."):(this.options.reconnect=this.defaultReconnect,this.heartbeat&&(this.heartbeat.onsleep=function(){}),this.heartbeat=new h({interval:15}),this.sock=this._connect(a))};
l.prototype.send=function(a){if(this.sock)if(0===this.sock.readyState)this.msgQueue.push(a);else try{this.sock.send(a)}catch(u){this.log("Error while sending. Closing socket: "+u.message),this.sock.close()}};l.prototype.close=function(){this.log("Closing socket");this.options.reconnect=!1;this.sock&&(this.sock.close(),this.sock=null);this.heartbeat&&(this.heartbeat.onsleep=function(){})};l.prototype._cleanupSocket=function(b){b&&(this.log("Cleaning up socket"),b.onopen=function(){b.close()},b.onmessage=
a,b.onerror=a,b.onclose=a,2>b.readyState&&b.close())};l.prototype._connect=function(a){var b=++a||1;this.log("attempting to connect");var c=null;try{c=new this._WebSocket(this.uri)}catch(r){return this.onerror({code:31E3,message:r.message||"Could not connect to "+this.uri}),this.close(),null}var e=this,f=this.sock,d=null,m=setTimeout(function(){e.log("connection attempt timed out");c.onclose=function(){};c.close();e.onclose();e._tryReconnect(b)},5E3);c.onopen=function(){clearTimeout(m);e._cleanupSocket(f);
d=(new Date).getTime();e.log("Socket opened");e.heartbeat.onsleep=function(){e.log("Heartbeat timed out. closing socket");e.sock.onclose=function(){};e.sock.close();e.onclose();e._tryReconnect(b)};e.heartbeat.beat();e.onopen();for(var a=0;a<e.msgQueue.length;a++)e.sock.send(e.msgQueue[a]);e.msgQueue=[]};c.onclose=function(){clearTimeout(m);e._cleanupSocket(f);e.heartbeat.onsleep=function(){};d&&10<((new Date).getTime()-d)/1E3&&(b=1);e.log("Socket closed");e.onclose();e._tryReconnect(b)};c.onerror=
function(a){e.log("Socket received error: "+a.message);e.onerror({code:31E3,message:a.message||"WSTransport socket error"})};c.onmessage=function(a){e.heartbeat.beat();if("\n"===a.data)e.send("\n");else e.onmessage(a)};return c};l.prototype._tryReconnect=function(a){a=a||0;if(this.options.reconnect){this.log("Attempting to reconnect.");var b=this,c=0,c=5>a?30+Math.round(50*Math.random()*Math.pow(2,a)):3E3;setTimeout(function(){b.open(a)},c)}};k.WSTransport=l},{"./heartbeat":7,"./log":8,ws:29}],29:[function(c,
g,k){g.exports=WebSocket},{}],30:[function(c,g,k){function a(a,c,f){return l(this,void 0,void 0,function(){function b(b,g){for(;;)switch(e){case 0:return m=new c,m.open("GET",f,!0),m.responseType="arraybuffer",e=1,{value:new Promise(function(a){m.addEventListener("load",a);m.send()}),done:!1};case 1:if(void 0===g){e=2;break}e=-1;throw g;case 2:h=d=b;try{return e=-1,{value:a.decodeAudioData(h.target.response),done:!0}}catch(w){e=3;break}case 3:return e=-1,{value:new Promise(function(b){a.decodeAudioData(h.target.response,
b)}),done:!0};case 4:e=-1;default:return{value:void 0,done:!0}}}var e=0,h,d,m,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g})}var l=this&&this.__awaiter||function(a,c,f,h){return new (f||(f=Promise))(function(b,e){function d(a){try{g(h.next(a))}catch(v){e(v)}}function m(a){try{g(h["throw"](a))}catch(v){e(v)}}function g(a){a.done?
b(a.value):(new f(function(b){b(a.value)})).then(d,m)}g((h=h.apply(a,c||[])).next())})};Object.defineProperty(k,"__esModule",{value:!0});var h=c("./Deferred"),f=c("./EventTarget");c=function(a,c,h){var b;c=void 0===c?{}:c;h=void 0===h?{}:h;b=f.default.call(this)||this;b._audioNode=null;b._pendingPlayDeferreds=[];b._loop=!1;b._src="";b._sinkId="default";"string"!==typeof c&&(h=c);b._audioContext=a;b._audioElement=new (h.AudioFactory||Audio);b._bufferPromise=b._createPlayDeferred().promise;b._destination=
b._audioContext.destination;b._gainNode=b._audioContext.createGain();b._gainNode.connect(b._destination);b._XMLHttpRequest=h.XMLHttpRequestFactory||XMLHttpRequest;b.addEventListener("canplaythrough",function(){b._resolvePlayDeferreds()});"string"===typeof c&&(b.src=c);return b};$jscomp.inherits(c,f.default);c.prototype.load=function(){this._load(this._src)};c.prototype.pause=function(){this.paused||(this._audioElement.pause(),this._audioNode.stop(),this._audioNode.disconnect(this._gainNode),this._audioNode=
null,this._rejectPlayDeferreds(Error("The play() request was interrupted by a call to pause().")))};c.prototype.play=function(){return l(this,void 0,void 0,function(){function a(a,b){for(;;)switch(c){case 0:g=k;if(k.paused){c=1;break}c=2;return{value:k._bufferPromise,done:!1};case 2:if(void 0===b){c=3;break}c=-1;throw b;case 3:if(k.paused){c=4;break}c=-1;return{value:void 0,done:!0};case 4:throw c=-1,Error("The play() request was interrupted by a call to pause().");case 1:return k._audioNode=k._audioContext.createBufferSource(),
k._audioNode.loop=k.loop,k._audioNode.addEventListener("ended",function(){g._audioNode&&g._audioNode.loop||g.dispatchEvent("ended")}),c=5,{value:k._bufferPromise,done:!1};case 5:if(void 0===b){c=6;break}c=-1;throw b;case 6:f=h=a;if(!k.paused){c=7;break}c=-1;throw Error("The play() request was interrupted by a call to pause().");case 7:k._audioNode.buffer=f;k._audioNode.connect(k._gainNode);k._audioNode.start();if(!k._audioElement.srcObject){c=8;break}c=-1;return{value:k._audioElement.play(),done:!0};
case 8:c=-1;default:return{value:void 0,done:!0}}}var c=0,f,h,g,k=this,d={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();d[Symbol.iterator]=function(){return this};return d})};c.prototype.setSinkId=function(a){return l(this,void 0,void 0,function(){function b(b,d){for(;;)switch(c){case 0:if("function"===typeof f._audioElement.setSinkId){c=1;break}c=-1;throw Error("This browser does not support setSinkId.");
case 1:if(a!==f.sinkId){c=2;break}c=-1;return{value:void 0,done:!0};case 2:if("default"!==a){c=3;break}f.paused||f._gainNode.disconnect(f._destination);f._audioElement.srcObject=null;f._destination=f._audioContext.destination;f._gainNode.connect(f._destination);f._sinkId=a;c=-1;return{value:void 0,done:!0};case 3:return c=4,{value:f._audioElement.setSinkId(a),done:!1};case 4:if(void 0===d){c=5;break}c=-1;throw d;case 5:if(!f._audioElement.srcObject){c=6;break}c=-1;return{value:void 0,done:!0};case 6:f._gainNode.disconnect(f._audioContext.destination),
f._destination=f._audioContext.createMediaStreamDestination(),f._audioElement.srcObject=f._destination.stream,f._sinkId=a,f.paused||f._gainNode.connect(f._destination),c=-1;default:return{value:void 0,done:!0}}}var c=0,f=this,h={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();h[Symbol.iterator]=function(){return this};return h})};c.prototype._createPlayDeferred=function(){var a=new h.default;
this._pendingPlayDeferreds.push(a);return a};c.prototype._load=function(b){var c=this;this._src&&this._src!==b&&this.pause();this._src=b;this._bufferPromise=new Promise(function(e,f){return l(c,void 0,void 0,function(){function c(c,m){for(;;)switch(f){case 0:if(b){f=1;break}f=-1;return{value:g._createPlayDeferred().promise,done:!0};case 1:return f=2,{value:a(g._audioContext,g._XMLHttpRequest,b),done:!1};case 2:if(void 0===m){f=3;break}f=-1;throw m;case 3:d=h=c,g.dispatchEvent("canplaythrough"),e(d),
f=-1;default:return{value:void 0,done:!0}}}var f=0,d,h,g=this,k={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k})})};c.prototype._rejectPlayDeferreds=function(a){var b=this._pendingPlayDeferreds;b.splice(0,b.length).forEach(function(b){b=b.reject;return b(a)})};c.prototype._resolvePlayDeferreds=function(a){var b=this._pendingPlayDeferreds;
b.splice(0,b.length).forEach(function(b){b=b.resolve;return b(a)})};$jscomp.global.Object.defineProperties(c.prototype,{destination:{configurable:!0,enumerable:!0,get:function(){return this._destination}},loop:{configurable:!0,enumerable:!0,get:function(){return this._loop},set:function(a){if(!a&&this.loop&&!this.paused){var b=function(){c._audioNode.removeEventListener("ended",b);c.pause()},c=this;this._audioNode.addEventListener("ended",b)}this._loop=a}},muted:{configurable:!0,enumerable:!0,get:function(){return 0===
this._gainNode.gain.value},set:function(a){this._gainNode.gain.value=a?0:1}},paused:{configurable:!0,enumerable:!0,get:function(){return null===this._audioNode}},src:{configurable:!0,enumerable:!0,get:function(){return this._src},set:function(a){this._load(a)}},sinkId:{configurable:!0,enumerable:!0,get:function(){return this._sinkId}}});k.default=c},{"./Deferred":31,"./EventTarget":32}],31:[function(c,g,k){Object.defineProperty(k,"__esModule",{value:!0});c=function(){var a=this;this.promise=new Promise(function(c,
h){a._resolve=c;a._reject=h})};$jscomp.global.Object.defineProperties(c.prototype,{reject:{configurable:!0,enumerable:!0,get:function(){return this._reject}},resolve:{configurable:!0,enumerable:!0,get:function(){return this._resolve}}});k.default=c},{}],32:[function(c,g,k){Object.defineProperty(k,"__esModule",{value:!0});var a=c("events");c=function(){this._eventEmitter=new a.EventEmitter};c.prototype.addEventListener=function(a,c){return this._eventEmitter.addListener(a,c)};c.prototype.dispatchEvent=
function(a,c){for(var f=[],b=1;b<arguments.length;++b)f[b-1]=arguments[b];return this._eventEmitter.emit.apply(this._eventEmitter,[].concat([a],$jscomp.arrayFromIterable(f)))};c.prototype.removeEventListener=function(a,c){return this._eventEmitter.removeListener(a,c)};k.default=c},{events:34}],33:[function(c,g,k){c=c("./AudioPlayer");g.exports=c.default},{"./AudioPlayer":30}],34:[function(c,g,k){function a(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function l(a){return"function"===
typeof a}function h(a){return"object"===typeof a&&null!==a}g.exports=a;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._maxListeners=void 0;a.defaultMaxListeners=10;a.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||isNaN(a))throw TypeError("n must be a positive number");this._maxListeners=a;return this};a.prototype.emit=function(a){var b,c,f,g;this._events||(this._events={});if("error"===a&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){b=arguments[1];
if(b instanceof Error)throw b;c=Error('Uncaught, unspecified "error" event. ('+b+")");c.context=b;throw c;}c=this._events[a];if(void 0===c)return!1;if(l(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:b=Array.prototype.slice.call(arguments,1),c.apply(this,b)}else if(h(c))for(b=Array.prototype.slice.call(arguments,1),g=c.slice(),c=g.length,f=0;f<c;f++)g[f].apply(this,b);return!0};a.prototype.addListener=
function(c,b){if(!l(b))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",c,l(b.listener)?b.listener:b);this._events[c]?h(this._events[c])?this._events[c].push(b):this._events[c]=[this._events[c],b]:this._events[c]=b;h(this._events[c])&&!this._events[c].warned&&(b=void 0!==this._maxListeners?this._maxListeners:a.defaultMaxListeners)&&0<b&&this._events[c].length>b&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this._events[c].length),"function"===typeof console.trace&&console.trace());return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function(a,b){function c(){this.removeListener(a,c);f||(f=!0,b.apply(this,arguments))}if(!l(b))throw TypeError("listener must be a function");var f=!1;c.listener=b;this.on(a,c);return this};a.prototype.removeListener=function(a,b){var c,f,g;if(!l(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;c=this._events[a];
g=c.length;f=-1;if(c===b||l(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(h(c)){for(;0<g--;)if(c[g]===b||c[g].listener&&c[g].listener===b){f=g;break}if(0>f)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(f,1);this._events.removeListener&&this.emit("removeListener",a,b)}return this};a.prototype.removeAllListeners=function(a){var b;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?
this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);this.removeAllListeners("removeListener");this._events={};return this}b=this._events[a];if(l(b))this.removeListener(a,b);else if(b)for(;b.length;)this.removeListener(a,b[b.length-1]);delete this._events[a];return this};a.prototype.listeners=function(a){return this._events&&this._events[a]?l(this._events[a])?[this._events[a]]:this._events[a].slice():
[]};a.prototype.listenerCount=function(a){if(this._events){a=this._events[a];if(l(a))return 1;if(a)return a.length}return 0};a.listenerCount=function(a,b){return a.listenerCount(b)}},{}],35:[function(c,g,k){g.exports.RTCIceCandidate=c("./rtcicecandidate");g.exports.RTCPeerConnection=c("./rtcpeerconnection");g.exports.RTCSessionDescription=c("./rtcsessiondescription")},{"./rtcicecandidate":38,"./rtcpeerconnection":39,"./rtcsessiondescription":41}],36:[function(c,g,k){function a(c,g,f,b,e,k,p,q,t,d){if(!(this instanceof
a))return new a(c,g,f,b,e,k,p,q,t,d);var h=!1;c=c||"0.0.0.0";p="number"===typeof p?p:9;q="boolean"===typeof q?q:!0;t=t||null;d=d||null;Object.defineProperties(this,{_address:{get:function(){return c},set:function(a){c=a}},_candidates:{value:[]},_port:{get:function(){return p},set:function(a){p=a}},_rejected:{get:function(){return h},set:function(a){h=a}},_streamId:{get:function(){return t},set:function(a){t=a}},_track:{get:function(){return d},set:function(a){d=a}},_triples:{value:new Set},candidates:{enumerable:!0,
get:function(){return this._candidates.slice()}},capabilities:{enumerable:!0,value:f},defaultCandidate:{enumerable:!0,get:function(){return this._candidates.length?this._candidates[0]:null}},direction:{enumerable:!0,value:b},kind:{enumerable:!0,value:e},port:{enumerable:!0,get:function(){return p}},rtcpMux:{enumerable:!0,value:q},streamId:{enumerable:!0,get:function(){return t}},track:{enumerable:!0,get:function(){return d}}});g&&g.forEach(this.addCandidate,this)}a.prototype.addCandidate=function(a){var c=
[a.ip,a.port,a.protocol].join(" ");return this._triples.has(c)?!1:(this._triples.add(c),this._candidates.push(a),!0)};a.prototype.copy=function(c,g,f,b,e,k,p){return new a(this.address,g,f||this.capabilities,b||this.direction,this.kind,this.mid,e,this.rtcpMux,k,p)};a.prototype.copyAndReject=function(){return(new a(null,this.candidates,this.capabilities,this.direction,this.kind,this.mid,null,this.rtcpMux)).reject()};a.prototype.reject=function(){this.setPort(0);return this};a.prototype.setAddress=
function(a){this._address=a;return this};a.prototype.setPort=function(a){this._port=a;return this};g.exports=a},{}],37:[function(c,g,k){function a(c,g){if(!(this instanceof a))return new a(c,g);Event.call(this,c,g);Object.defineProperties(this,{stream:{enumerable:!0,value:g.stream}})}g.exports=a},{}],38:[function(c,g,k){function a(c){if(!(this instanceof a))return new a(c);Object.defineProperties(this,{candidate:{enumerable:!0,value:c.candidate},sdpMLineIndex:{enumerable:!0,value:c.sdpMLineIndex}})}
g.exports=a},{}],39:[function(c,g,k){function a(b){if(!(this instanceof a))return new a(b);b={gatherPolicy:b.gatherPolicy||"all",iceServers:[]};var c=new RTCIceGatherer(b),d=!1;c.onlocalcandidate=this._onlocalcandidate.bind(this);var e=null,f=!1,g=0,h=new RTCIceTransport,k=null;h.onicestatechange=this._onicestatechange.bind(this);var l=new RTCDtlsTransport(h);l.ondtlsstatechange=this._ondtlsstatechange.bind(this);var q="stable",p=null,t=null,u=null,y=null;Object.defineProperties(this,{_dtlsTransport:{value:l},
_dtmfSenders:{value:new Map},_gatherOptions:{value:b},_iceCandidatesAdded:{get:function(){return g},set:function(a){g=a}},_iceGatherer:{value:c},_iceGatheringCompleted:{get:function(){return d},set:function(a){d=a}},_iceTransport:{value:h},_localCandidates:{value:new Set},_localDescription:{get:function(){return t},set:function(a){t=a}},_localStreams:{value:new Set},_midCounters:{value:{audio:0,video:0}},_remoteCandidates:{value:new Set},_remoteDescription:{get:function(){return u},set:function(a){u=
a}},_remoteStreams:{value:[]},_rtpReceivers:{value:new Map},_rtpSenders:{value:new Map},_signalingState:{get:function(){return q},set:function(a){q=a;if(this.onsignalingstatechange)this.onsignalingstatechange()}},_streamIds:{value:new Map},iceConnectionState:{enumerable:!0,get:function(){return h.state}},iceGatheringState:{enumerable:!0,get:function(){return d?"gathering":"complete"}},localDescription:{enumerable:!0,get:function(){return t}},onaddstream:{enumerable:!0,get:function(){return y},set:function(a){y=
a}},onicecandidate:{enumerable:!0,get:function(){return e},set:function(a){e=a;if(!f)try{c.getLocalCandidates().forEach(c.onlocalcandidate)}catch(z){}f=!0}},oniceconnectionstatechange:{enumerable:!0,get:function(){return k},set:function(a){k=a}},onsignalingstatechange:{enumerable:!0,get:function(){return p},set:function(a){p=a}},remoteDescription:{enumerable:!0,get:function(){return u}},signalingState:{enumerable:!0,get:function(){return q}}})}function l(a){return Error("Invalid signaling state: "+
a)}function h(a,b){var c=[];a.forEach(function(a){b.forEach(function(b){a.name===b.name&&a.clockRate===b.clockRate&&a.numChannels===b.numChannels&&c.push(b)})});return c}var f=c("./mediasection"),b=c("./mediastreamevent"),e=c("./rtcicecandidate"),u=c("./rtcpeerconnectioniceevent"),p=c("./rtcsessiondescription"),q=c("sdp-transform"),t=c("./sdp-utils");a.prototype._makeMid=function(a){return a+ ++this._midCounters[a]};a.prototype._ondtlsstatechange=function(a){void 0};a.prototype._onicestatechange=
function(a){if(this.oniceconnectionstatechange)this.oniceconnectionstatechange(a)};a.prototype._onlocalcandidate=function(a){Object.keys(a.candidate).length||(this._iceGatheringCompleted=!0);this._localCandidates.add(a.candidate);if(this.onicecandidate){a=a.candidate;if(Object.keys(a).length){var b=["a=candidate",a.foundation,1,a.protocol,a.priority,a.ip,a.port,a.type];a.relatedAddress&&(b=b.concat(["raddr",a.relatedAddress,"rport",a.relatedPort]));b.push("generation 0");a=new e({candidate:b.join(" "),
sdpMLineIndex:0})}else a=null;this.onicecandidate(new u("icecandidate",{candidate:a}))}};a.prototype._sendRtp=function(a){var b=a.kind;this._rtpSenders.forEach(function(c){c.track.kind===b&&c.send(a.capabilities)},this);return this};a.prototype._sendAndReceiveRtp=function(a){a.forEach(function(a){"sendrecv"!==a.direction&&"sendonly"!==a.direction||this._sendRtp(a);"sendrecv"!==a.direction&&"recvonly"!==a.direction||this._receiveRtp(a)},this);return this};a.prototype._receiveRtp=function(a){var c=
new RTCRtpReceiver(this._dtlsTransport,a.capabilities.type);c.receive(a.capabilities);a=c.track;this._rtpReceivers.set(a,c);c=new MediaStream;c.addTrack(a);this._remoteStreams.push(c);if(this.onaddstream)this.onaddstream(new b("addstream",{stream:c}));return this};a.prototype._startDtlsTransport=function(a){this._dtlsTransport.start(a);return this};a.prototype._startIceTransport=function(a){this._iceTransport.start(this._iceGatherer,a,"have-local-offer"===this.signalingState?"controlling":"controlled");
return this};a.prototype.addIceCandidate=function(a,b,c){if(!b)return new Promise(this.addIceCandidate.bind(this,a));void 0;this._iceCandidatesAdded++;a?(c=a.candidate.indexOf("candidate:"),a=a.candidate.slice(c+10).replace(/ +/g," ").split(" "),c={foundation:a[0],protocol:a[2],priority:parseInt(a[3]),ip:a[4],port:parseInt(a[5]),type:a[7],relatedAddress:null,relatedPort:0,tcpType:"active"},"host"!==c.type&&(c.relatedAddress=a[9],c.relatedPort=parseInt(a[11])),a=c):a={};c=[a.ip,a.port,a.transport].join(" ");
this._remoteCandidates.has(c)||(this._remoteCandidates.add(c),this._iceTransport.addRemoteCandidate(a));b&&b()};a.prototype.addStream=function(a){this._localStreams.add(a);a.getTracks().forEach(function(b){var c=new RTCRtpSender(b,this._dtlsTransport);this._rtpSenders.set(b,c);this._streamIds.set(b,a.id)},this)};a.prototype.close=function(){this._signalingState="closed";this._rtpReceivers.forEach(function(a){a.stop()});this._dtlsTransport.stop();this._iceTransport.stop()};a.prototype.createAnswer=
function(a,b){if("function"!==typeof a)return new Promise(this.createAnswer.bind(this));if("have-remote-offer"!==this.signalingState)return void b(l(this.signalingState));b=t.parseDescription(this.remoteDescription);var c={audio:[],video:[]};this.getLocalStreams().forEach(function(a){c.audio=c.audio.concat(a.getAudioTracks());c.video=c.video.concat(a.getVideoTracks())});b=b.mediaSections.map(function(a){var b=a.kind,d=a.direction,e=a.capabilities,f=RTCRtpSender.getCapabilities(b),f=h(e.codecs,f.codecs),
e={codecs:f},g;if(!f.length)return a.copyAndReject();"inactive"===d||"recvonly"===d&&!c[b].length?b="inactive":"recvonly"===d?(g=c[b].shift(),b="sendonly"):b="sendrecv"===d?(g=c[b].shift())?"sendrecv":"recvonly":"recvonly";d=this._streamIds.get(g);return a.copy(null,null,e,b,null,d,g)},this);b.forEach(function(a){this._localCandidates.forEach(a.addCandidate,a)},this);var d=t.makeInitialSDPBlob();t.addMediaSectionsToSDPBlob(d,b);t.addIceParametersToSDPBlob(d,this._iceGatherer.getLocalParameters());
t.addDtlsParametersToSDPBlob(d,this._dtlsTransport.getLocalParameters());b=new p({sdp:q.write(d),type:"answer"});a(b)};a.prototype.createDTMFSender=function(a){if(!this._dtmfSenders.has(a)){var b=this._rtpSenders.get(a),b=new RTCDtmfSender(b);this._dtmfSenders.set(a,b)}return this._dtmfSenders.get(a)};a.prototype.createOffer=function(a,b,c){if("function"!==typeof a)return new Promise(function(b,c){this.createOffer(b,c,a)}.bind(this));var d={audio:null,video:null},e={audio:0,video:0};c=c||{};["optional",
"mandatory"].forEach(function(a){a in c&&("OfferToReceiveAudio"in c[a]&&(d.audio=Number(c[a].OfferToReceiveAudio)),"OfferToReceiveVideo"in c[a]&&(d.video=Number(c[a].OfferToReceiveVideo)))});var g=[],h={audio:d.audio,video:d.video};this.getLocalStreams().forEach(function(a){var b=a.getAudioTracks(),c=a.getVideoTracks();e.audio+=b.length;e.video+=c.length;b.concat(c).forEach(function(b){var c=b.kind,d=RTCRtpSender.getCapabilities(c),e,k=this._makeMid(c);null===h.audio?e="sendrecv":h[c]?(h[c]--,e="sendrecv"):
e="sendonly";b=new f(null,null,d,e,c,k,null,null,a.id,b);g.push(b)},this)},this);["audio","video"].forEach(function(a){var b=Math.max(d[a]-e[a],0);if(b)for(var c=RTCRtpSender.getCapabilities(a),h;b--;)h=this._makeMid(a),h=new f(null,null,c,"recvonly",a,h),g.push(h)},this);g.forEach(function(a){this._localCandidates.forEach(a.addCandidate,a)},this);b=t.makeInitialSDPBlob();t.addMediaSectionsToSDPBlob(b,g);t.addIceParametersToSDPBlob(b,this._iceGatherer.getLocalParameters());t.addDtlsParametersToSDPBlob(b,
this._dtlsTransport.getLocalParameters());b=new p({sdp:q.write(b),type:"offer"});a(b)};a.prototype.getLocalStreams=function(){return Array.from(this._localStreams)};a.prototype.getRemoteStreams=function(){return this._remoteStreams.slice()};a.prototype.removeStream=function(a){this._localStreams.delete(a);a.getTracks().forEach(function(a){this._rtpSenders.get(a).stop();this._rtpSenders.delete(a);this._streamIds.delete(a)},this)};a.prototype.setLocalDescription=function(a,b,c){if(!b)return new Promise(this.setLocalDescription.bind(this,
a));switch(this.signalingState){case "stable":c="have-local-offer";break;case "have-remote-offer":c="stable";break;default:return void c(l(this.signalingState))}var d=t.parseDescription(a);if("have-remote-offer"===this.signalingState){d.mediaSections.forEach(this._sendRtp,this);var e=t.parseDescription(this.remoteDescription).mediaSections[0].capabilities.encodings[0].ssrc;d.mediaSections.forEach(function(a){a.capabilities.encodings.forEach(function(a){a.ssrc=e});a.capabilities.rtcp.ssrc=e});d.mediaSections.forEach(this._receiveRtp,
this)}this._localDescription=a;this._signalingState=c;b()};a.prototype.setRemoteDescription=function(a,b,c){if(!b)return new Promise(this.setRemoteDescription.bind(this,a));switch(this.signalingState){case "stable":c="have-remote-offer";break;case "have-local-offer":c="stable";break;default:return void c(l(this.signalingState))}var d=t.parseDescription(a);"closed"!==this._iceTransport.state&&"completed"!==this._iceTransport.state&&(d.mediaSections.forEach(function(a){a.candidates.forEach(this._iceTransport.addRemoteCandidate,
this._iceTransport)},this),this._startIceTransport(d.iceParameters[0]),this._startDtlsTransport(d.dtlsParameters[0]));"have-local-offer"===this.signalingState&&(d.mediaSections.forEach(this._receiveRtp,this),d.mediaSections.forEach(this._sendRtp,this));this._remoteDescription=a;this._signalingState=c;b()};g.exports=a},{"./mediasection":36,"./mediastreamevent":37,"./rtcicecandidate":38,"./rtcpeerconnectioniceevent":40,"./rtcsessiondescription":41,"./sdp-utils":42,"sdp-transform":44}],40:[function(c,
g,k){function a(c,g){if(!(this instanceof a))return new a(c,g);Event.call(this,c,g);Object.defineProperties(this,{candidate:{enumerable:!0,value:g.candidate}})}g.exports=a},{}],41:[function(c,g,k){function a(c){if(!(this instanceof a))return new a(c);Object.defineProperties(this,{sdp:{enumerable:!0,value:c.sdp},type:{enumerable:!0,value:c.type}})}g.exports=a},{}],42:[function(c,g,k){function a(a,b,c){a=a||{};a.candidates=a.candidates||[];if(!b)return a;b.forEach(function(b){if(b.foundation){var d=
{foundation:b.foundation,transport:b.protocol,priority:b.priority,ip:b.ip,port:b.port,type:b.type,generation:0};b.relatedAddress&&(d.raddr=b.relatedAddress,d.rport=b.relatedPort);if("number"===typeof c)d.component=c,a.candidates.push(d);else{d.component=1;a.candidates.push(d);b={};for(var e in d)b[e]=d[e];b.component=2;a.candidates.push(b)}}else a.endOfCandidates="end-of-candidates"});return a}function l(b,c,d){b=b||{};if(!b.media)return b;b.media.forEach(function(b){a(b,c,d)});return b}function h(a,
b){a=a||{};if(!a.media)return a;a.media.forEach(function(a){a=a||{};var c=b.fingerprints;c.length&&(a.fingerprint={type:c[0].algorithm,hash:c[0].value})});return a}function f(a,b){a=a||{};if(!a.media)return a;a.media.forEach(function(a){a=a||{};a.iceUfrag=b.usernameFragment;a.icePwd=b.password});return a}function b(b,c){var d=c.streamId;d&&(b.msidSemantic=b.msidSemantic||{semantic:"WMS",token:[]},b.msidSemantic.token.push(d));var f=c.mid;if(f){b.groups=b.groups||[];var g=!1;b.groups.forEach(function(a){"BUNDLE"===
a.type&&(a.mids.push(f),g=!0)});g||b.groups.push({type:"BUNDLE",mids:[f]})}var h=[],k=[],l=[];c.capabilities.codecs.forEach(function(a){var b=a.preferredPayloadType;h.push(b);var c={payload:b,codec:a.name,rate:a.clockRate};1<a.numChannels&&(c.encoding=a.numChannels);k.push(c);switch(a.name){case "telephone-event":a.parameters&&a.parameters.events&&l.push({payload:b,config:a.parameters.events})}});var q=[];if(d&&c.track)var d=Math.floor(4294967296*Math.random()),p=e(),t=c.track.id,q=q.concat([{id:d,
attribute:"cname",value:p},{id:d,attribute:"msid",value:c.streamId+" "+t},{id:d,attribute:"mslabel",value:t},{id:d,attribute:"label",value:t}]);d=c.defaultCandidate;q={rtp:k,fmtp:l,type:c.kind,port:d?d.port:9,payloads:h.join(" "),protocol:"RTP/SAVPF",direction:c.direction,connection:{version:4,ip:d?d.ip:"0.0.0.0"},rtcp:{port:d?d.port:9,netType:"IN",ipVer:4,address:d?d.ip:"0.0.0.0"},ssrcs:q};f&&(q.mid=f);c.rtcpMux&&(q.rtcpMux="rtcp-mux");a(q,c.candidates);b.media.push(q);return b}function e(){for(var a=
"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/".split(""),b=16,c="";b--;)c+=a[Math.floor(Math.random()*a.length)];return c}var u=c("./mediasection"),p=c("sdp-transform");g.exports.addCandidatesToSDPBlob=function(a,b,c){a=a||{};l(a,b,c);return a};g.exports.addDtlsParametersToSDPBlob=function(a,b){a=a||{};h(a,b);return a};g.exports.addIceParametersToSDPBlob=function(a,b){a=a||{};f(a,b);return a};g.exports.addMediaSectionsToSDPBlob=function(a,c){c.forEach(b.bind(null,a));return a};
g.exports.makeInitialSDPBlob=function(a){a=a||Math.floor(4294967296*Math.random());return{version:0,origin:{username:"-",sessionId:a,sessionVersion:0,netType:"IN",ipVer:4,address:"127.0.0.1"},name:"-",timing:{start:0,stop:0},connection:{version:4,ip:"0.0.0.0"},media:[]}};g.exports.parseDescription=function(a){a=p.parse(a.sdp);var b=[],c=[],e=[],f=[],g=[a];a.media&&(g=g.concat(a.media));g.forEach(function(a){a.iceUfrag&&a.icePwd&&a.fingerprint&&(b.push({usernameFragment:a.iceUfrag,password:a.icePwd}),
c.push({fingerprints:[{algorithm:a.fingerprint.type,value:a.fingerprint.hash}]}));if(a.rtp&&"video"!==a.type){var d=a.connection?a.connection.ip:null,g=a.direction,h=a.type,k=a.mid,l=a.port||null,m="rtcp-mux"===a.rtcpMux,p,n,q;(a.ssrcs||[]).forEach(function(a){switch(a.attribute){case "cname":n=a.id;p=a.value;break;case "label":case "mslabel":n=a.id;break;case "msid":n=a.id,q=a.value.split(" ")[0]}});var t={type:h,muxId:k,codecs:a.rtp.map(function(a){var b={name:a.codec,payloadType:parseInt(a.payload),
clockRate:parseInt(a.rate),numChannels:a.encoding||1,rtcpFeedback:[],parameters:{}};switch(a.codec){case "telephone-event":b.parameters.events="0-16"}return b}),headerExtensions:[],encodings:a.rtp.map(function(a){return{ssrc:n,codecPayloadType:parseInt(a.payload),active:!0}}),rtcp:{ssrc:n,cname:p,mux:m}},r=new u(d,e,t,g,h,k,l,m,q);(a.candidates||[]).forEach(function(a){a={foundation:String(a.foundation),protocol:a.transport,priority:a.priority,ip:a.ip,port:a.port,type:a.type,relatedAddress:a.raddr,
relatedPort:a.rport};e.push(a);r.addCandidate(a)});void 0;"end-of-candidates"===a.endOfCandidates&&r.addCandidate({});f.push(r)}});return{iceParameters:b,dtlsParameters:c,mediaSections:f}}},{"./mediasection":36,"sdp-transform":44}],43:[function(c,g,k){var a=g.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:"username sessionId sessionVersion netType ipVer address".split(" "),format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],
u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,
names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":a.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,
names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(a){return null!=a.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],
format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},
{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:"foundation component transport priority ip port type raddr rport tcptype generation network-id network-cost".split(" "),format:function(a){var c;
c="candidate:%s %d %s %d %s %d typ %s"+(null!=a.raddr?" raddr %s rport %d":"%v%v");c+=null!=a.tcptype?" tcptype %s":"%v";null!=a.generation&&(c+=" generation %d");c+=null!=a["network-id"]?" network-id %d":"%v";return c+=null!=a["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,
names:["id","attribute","value"],format:function(a){var c="ssrc:%d";null!=a.attribute&&(c+=" %s",null!=a.value&&(c+=":%s"));return c}},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},
{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(a){return null!=a.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{push:"invalid",names:["value"]}]};Object.keys(a).forEach(function(c){a[c].forEach(function(a){a.reg||(a.reg=/(.*)/);a.format||(a.format="%s")})})},{}],44:[function(c,g,k){g=c("./parser");c=c("./writer");k.write=c;k.parse=g.parse;k.parseFmtpConfig=g.parseFmtpConfig;k.parsePayloads=g.parsePayloads;k.parseRemoteCandidates=
g.parseRemoteCandidates},{"./parser":45,"./writer":46}],45:[function(c,g,k){var a=function(a){return String(Number(a))===a?Number(a):a},l=c("./grammar"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);k.parse=function(b){var c={},f=[],g=c;b.split(/(\r\n|\r|\n)/).filter(h).forEach(function(b){var c=b[0],d=b.slice(2);"m"===c&&(f.push({rtp:[],fmtp:[]}),g=f[f.length-1]);for(b=0;b<(l[c]||[]).length;b+=1){var e=l[c][b];if(e.reg.test(d)){c=e;b=g;e=d;d=c.name&&c.names;c.push&&!b[c.push]?b[c.push]=[]:d&&!b[c.name]&&
(b[c.name]={});var d=c.push?{}:d?b[c.name]:b,e=e.match(c.reg),k=d,h=c.names,p=c.name;if(p&&!h)k[p]=a(e[1]);else for(p=0;p<h.length;p+=1)null!=e[p+1]&&(k[h[p]]=a(e[p+1]));c.push&&b[c.push].push(d);break}}});c.media=f;return c};var f=function(b,c){c=c.split(/=(.+)/,2);2===c.length&&(b[c[0]]=a(c[1]));return b};k.parseFmtpConfig=function(a){return a.split(/\;\s?/).reduce(f,{})};k.parsePayloads=function(a){return a.split(" ").map(Number)};k.parseRemoteCandidates=function(b){var c=[];b=b.split(" ").map(a);
for(var f=0;f<b.length;f+=3)c.push({component:b[f],ip:b[f+1],port:b[f+2]});return c}},{"./grammar":43}],46:[function(c,g,k){var a=c("./grammar"),l=/%[sdv%]/g,h=function(a){var b=1,c=arguments,e=c.length;return a.replace(l,function(a){if(b>=e)return a;var d=c[b];b+=1;switch(a){case "%%":return"%";case "%s":return String(d);case "%d":return Number(d);case "%v":return""}})},f=function(a,b,c){var e=b.format instanceof Function?b.format(b.push?c:c[b.name]):b.format;a=[a+"="+e];if(b.names)for(e=0;e<b.names.length;e+=
1){var d=b.names[e];b.name?a.push(c[b.name][d]):a.push(c[b.names[e]])}else a.push(c[b.name]);return h.apply(null,a)},b="vosiuepcbtrza".split(""),e=["i","c","b","a"];g.exports=function(c,g){g=g||{};null==c.version&&(c.version=0);null==c.name&&(c.name=" ");c.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var h=g.innerOrder||e,k=[];(g.outerOrder||b).forEach(function(b){a[b].forEach(function(a){a.name in c&&null!=c[a.name]?k.push(f(b,a,c)):a.push in c&&null!=c[a.push]&&c[a.push].forEach(function(c){k.push(f(b,
a,c))})})});c.media.forEach(function(b){k.push(f("m",a.m[0],b));h.forEach(function(c){a[c].forEach(function(a){a.name in b&&null!=b[a.name]?k.push(f(c,a,b)):a.push in b&&null!=b[a.push]&&b[a.push].forEach(function(b){k.push(f(c,a,b))})})})});return k.join("\r\n")+"\r\n"}},{"./grammar":43}],47:[function(c,g,k){g.exports="function"===typeof Object.create?function(a,c){a.super_=c;a.prototype=Object.create(c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,c){a.super_=
c;var g=function(){};g.prototype=c.prototype;a.prototype=new g;a.prototype.constructor=a}},{}],48:[function(c,g,k){g.exports=function(a){return a&&"object"===typeof a&&"function"===typeof a.copy&&"function"===typeof a.fill&&"function"===typeof a.readUInt8}},{}],49:[function(c,g,k){function a(a,c){var d={seen:[],stylize:h};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);m(c)?d.showHidden=c:c&&k._extend(d,c);v(d.showHidden)&&(d.showHidden=!1);v(d.depth)&&(d.depth=
2);v(d.colors)&&(d.colors=!1);v(d.customInspect)&&(d.customInspect=!0);d.colors&&(d.stylize=l);return b(d,a,d.depth)}function l(b,c){return(c=a.styles[c])?"\u001b["+a.colors[c][0]+"m"+b+"\u001b["+a.colors[c][1]+"m":b}function h(a,b){return a}function f(a){var b={};a.forEach(function(a,c){b[a]=!0});return b}function b(a,c,g){if(a.customInspect&&c&&H(c.inspect)&&c.inspect!==k.inspect&&(!c.constructor||c.constructor.prototype!==c)){var h=c.inspect(g,a);n(h)||(h=b(a,h,g));return h}if(h=e(a,c))return h;
var l=Object.keys(c),m=f(l);a.showHidden&&(l=Object.getOwnPropertyNames(c));if(G(c)&&(0<=l.indexOf("message")||0<=l.indexOf("description")))return u(c);if(0===l.length){if(H(c))return a.stylize("[Function"+(c.name?": "+c.name:"")+"]","special");if(w(c))return a.stylize(RegExp.prototype.toString.call(c),"regexp");if(F(c))return a.stylize(Date.prototype.toString.call(c),"date");if(G(c))return u(c)}var h="",E=!1,r=["{","}"];d(c)&&(E=!0,r=["[","]"]);H(c)&&(h=" [Function"+(c.name?": "+c.name:"")+"]");
w(c)&&(h=" "+RegExp.prototype.toString.call(c));F(c)&&(h=" "+Date.prototype.toUTCString.call(c));G(c)&&(h=" "+u(c));if(0===l.length&&(!E||0==c.length))return r[0]+h+r[1];if(0>g)return w(c)?a.stylize(RegExp.prototype.toString.call(c),"regexp"):a.stylize("[Object]","special");a.seen.push(c);l=E?p(a,c,g,m,l):l.map(function(b){return q(a,c,g,m,b,E)});a.seen.pop();return t(l,h,r)}function e(a,b){if(v(b))return a.stylize("undefined","undefined");if(n(b))return b="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,
"\\'").replace(/\\"/g,'"')+"'",a.stylize(b,"string");if(r(b))return a.stylize(""+b,"number");if(m(b))return a.stylize(""+b,"boolean");if(null===b)return a.stylize("null","null")}function u(a){return"["+Error.prototype.toString.call(a)+"]"}function p(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)Object.prototype.hasOwnProperty.call(b,String(g))?f.push(q(a,b,c,d,String(g),!0)):f.push("");e.forEach(function(e){e.match(/^\d+$/)||f.push(q(a,b,c,d,e,!0))});return f}function q(a,c,d,e,f,g){var h,k;c=Object.getOwnPropertyDescriptor(c,
f)||{value:c[f]};c.get?k=c.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):c.set&&(k=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(e,f)||(h="["+f+"]");k||(0>a.seen.indexOf(c.value)?(k=null===d?b(a,c.value,null):b(a,c.value,d-1),-1<k.indexOf("\n")&&(k=g?k.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+k.split("\n").map(function(a){return"   "+a}).join("\n"))):k=a.stylize("[Circular]","special"));if(v(h)){if(g&&f.match(/^\d+$/))return k;
h=JSON.stringify(""+f);h.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(h=h.substr(1,h.length-2),h=a.stylize(h,"name")):(h=h.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),h=a.stylize(h,"string"))}return h+": "+k}function t(a,b,c){var d=0;return 60<a.reduce(function(a,b){d++;0<=b.indexOf("\n")&&d++;return a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function d(a){return Array.isArray(a)}function m(a){return"boolean"===
typeof a}function r(a){return"number"===typeof a}function n(a){return"string"===typeof a}function v(a){return void 0===a}function w(a){return B(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function B(a){return"object"===typeof a&&null!==a}function F(a){return B(a)&&"[object Date]"===Object.prototype.toString.call(a)}function G(a){return B(a)&&("[object Error]"===Object.prototype.toString.call(a)||a instanceof Error)}function H(a){return"function"===typeof a}function A(a){return 10>a?
"0"+a.toString(10):a.toString(10)}function x(){var a=new Date,b=[A(a.getHours()),A(a.getMinutes()),A(a.getSeconds())].join(":");return[a.getDate(),z[a.getMonth()],b].join(" ")}var C=/%[sdj%]/g;k.format=function(b){if(!n(b)){for(var c=[],d=0;d<arguments.length;d++)c.push(a(arguments[d]));return c.join(" ")}for(var d=1,e=arguments,f=e.length,c=String(b).replace(C,function(a){if("%%"===a)return"%";if(d>=f)return a;switch(a){case "%s":return String(e[d++]);case "%d":return Number(e[d++]);case "%j":try{return JSON.stringify(e[d++])}catch(K){return"[Circular]"}default:return a}}),
g=e[d];d<f;g=e[++d])c=null!==g&&B(g)?c+(" "+a(g)):c+(" "+g);return c};k.deprecate=function(a,b){if(v(global.process))return function(){return k.deprecate(a,b).apply(this,arguments)};if(!0===process.noDeprecation)return a;var c=!1;return function(){if(!c){if(process.throwDeprecation)throw Error(b);process.traceDeprecation?console.trace(b):console.error(b);c=!0}return a.apply(this,arguments)}};var y={},D;k.debuglog=function(a){v(D)&&(D=process.env.NODE_DEBUG||"");a=a.toUpperCase();if(!y[a])if((new RegExp("\\b"+
a+"\\b","i")).test(D)){var b=process.pid;y[a]=function(){var c=k.format.apply(k,arguments);console.error("%s %d: %s",a,b,c)}}else y[a]=function(){};return y[a]};k.inspect=a;a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};a.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};
k.isArray=d;k.isBoolean=m;k.isNull=function(a){return null===a};k.isNullOrUndefined=function(a){return null==a};k.isNumber=r;k.isString=n;k.isSymbol=function(a){return"symbol"===typeof a};k.isUndefined=v;k.isRegExp=w;k.isObject=B;k.isDate=F;k.isError=G;k.isFunction=H;k.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||"symbol"===typeof a||"undefined"===typeof a};k.isBuffer=c("./support/isBuffer");var z="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");
k.log=function(){console.log("%s - %s",x(),k.format.apply(k,arguments))};k.inherits=c("inherits");k._extend=function(a,b){if(!b||!B(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}},{"./support/isBuffer":48,inherits:47}],50:[function(c,g,k){k.XMLHttpRequest=XMLHttpRequest},{}]},{},[1]);
